(function(n){"use strict";n.IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};n.IntelliFactory.Runtime.OnLoad(function(){n.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});n.ignore=function(){};n.id=function(n){return n};n.fst=function(n){return n[0]};n.snd=function(n){return n[1]};n.trd=function(n){return n[2]};n.console||(n.console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore})})(self);
var JSON;JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function f(n){return o.lastIndex=0,o.test(n)?'"'+n.replace(o,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function r(i,e){var s,l,h,a,v=n,c,o=e[i];o&&typeof o=="object"&&typeof o.toJSON=="function"&&(o=o.toJSON(i));typeof t=="function"&&(o=t.call(e,i,o));switch(typeof o){case"string":return f(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":return String(o);case"object":if(!o)return"null";if(n+=u,c=[],Object.prototype.toString.apply(o)==="[object Array]"){for(a=o.length,s=0;s<a;s+=1)c[s]=r(s,o)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));else for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&(h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,u,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",u="",typeof e=="number")for(o=0;o<e;o+=1)u+=" ";else typeof e=="string"&&(u=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return r("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),e.lastIndex=0,e.test(n)&&(n=n.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}();
/* https://github.com/jonathantneal/closest */
(function(w,p){p=w.Element.prototype
if(!p.matches){p.matches=p.msMatchesSelector||function(s){var m=(this.document||this.ownerDocument).querySelectorAll(s);for(var i=0;m[i]&&m[i]!==e;++i);return!!m[i]}}
if(!p.closest){p.closest=function(s){var e=this;while(e&&e.nodeType==1){if(e.matches(s))return e;e=e.parentNode}return null}}})(self);
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0;b=a.ShoppingCart=a.ShoppingCart||{};c=b.Client=b.Client||{};d=a.WebSharper=a.WebSharper||{};e=d.Operators=d.Operators||{};f=d.Arrays=d.Arrays||{};g=d.Obj=d.Obj||{};h=d.UI=d.UI||{};i=h.Templating=h.Templating||{};j=i.Runtime=i.Runtime||{};k=j.Server=j.Server||{};l=k.ProviderBuilder=k.ProviderBuilder||{};m=d.Remoting=d.Remoting||{};n=m.AjaxRemotingProvider=m.AjaxRemotingProvider||{};o=h.Var=h.Var||{};p=d.Concurrency=d.Concurrency||{};q=d.JavaScript=d.JavaScript||{};r=q.Pervasives=q.Pervasives||{};s=k.TemplateInstance=k.TemplateInstance||{};t=a.StartupCode$ShoppingCart$Client=a.StartupCode$ShoppingCart$Client||{};u=d.Collections=d.Collections||{};v=u.List=u.List||{};w=d.Unchecked=d.Unchecked||{};x=a.System=a.System||{};y=x.Guid=x.Guid||{};z=d.List=d.List||{};A=z.T=z.T||{};B=p.CT=p.CT||{};C=p.AsyncBody=p.AsyncBody||{};D=k.Handler=k.Handler||{};E=h.Var$1=h.Var$1||{};F=h.ListModel=h.ListModel||{};G=c.CartItem=c.CartItem||{};H=h.View=h.View||{};I=h.Doc=h.Doc||{};J=a.ShoppingCart_Templates=a.ShoppingCart_Templates||{};K=d.Seq=d.Seq||{};L=q.JS=q.JS||{};M=a.Object;N=h.AttrProxy=h.AttrProxy||{};O=h.CheckedInput=h.CheckedInput||{};P=d.Numeric=d.Numeric||{};Q=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};R=p.Scheduler=p.Scheduler||{};S=u.Dictionary=u.Dictionary||{};T=u.HashSet=u.HashSet||{};U=k.TemplateInitializer=k.TemplateInitializer||{};V=h.Client=h.Client||{};W=V.Templates=V.Templates||{};X=h.ConcreteVar=h.ConcreteVar||{};Y=h.Snap=h.Snap||{};Z=h.Storage=h.Storage||{};_0=h.Array=h.Array||{};_1=d.Json=d.Json||{};_2=d.CancellationTokenSource=d.CancellationTokenSource||{};_3=u.DictionaryUtil=u.DictionaryUtil||{};_4=d.Enumerator=d.Enumerator||{};_5=_4.T=_4.T||{};_6=a.EventTarget;_7=a.Node;_8=h.Abbrev=h.Abbrev||{};_9=_8.Fresh=_8.Fresh||{};_=Z.ArrayStorage=Z.ArrayStorage||{};$=h.ReactiveExtensions=h.ReactiveExtensions||{};ba=h.DomUtility=h.DomUtility||{};bb=h.DocElemNode=h.DocElemNode||{};bc=a.CharacterData;bd=a.Error;be=d.OperationCanceledException=d.OperationCanceledException||{};bf=a.StartupCode$WebSharper_Main$Remoting=a.StartupCode$WebSharper_Main$Remoting||{};bg=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bh=W.Prepare=W.Prepare||{};bi=d.Slice=d.Slice||{};bj=a.WindowOrWorkerGlobalScope;bk=h.Elt=h.Elt||{};bl=h.Docs=h.Docs||{};bm=h.An=h.An||{};bn=V.Settings=V.Settings||{};bo=_8.Mailbox=_8.Mailbox||{};bp=V.Attrs=V.Attrs||{};bq=bp.Dyn=bp.Dyn||{};br=m.XhrProvider=m.XhrProvider||{};bs=d.Strings=d.Strings||{};bt=h.Attrs=h.Attrs||{};bu=h.AttrModule=h.AttrModule||{};bv=h.Updates=h.Updates||{};bw=u.ValueCollection=u.ValueCollection||{};bx=V.Docs=V.Docs||{};by=bx.RunState=bx.RunState||{};bz=bx.NodeSet=bx.NodeSet||{};bA=h.Anims=h.Anims||{};bB=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bC=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};bD=u.HashSetUtil=u.HashSetUtil||{};bE=u.KeyCollection=u.KeyCollection||{};bF=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};bG=h.BindVar=h.BindVar||{};bH=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};bI=h.AppendList=h.AppendList||{};bJ=d.Queue=d.Queue||{};bK=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};bL=h.DynamicAttrNode=h.DynamicAttrNode||{};bM=h.Easing=h.Easing||{};bN=_8.HashSet=_8.HashSet||{};bO=h.String=h.String||{};bP=bx.DomNodes=bx.DomNodes||{};bQ=d.Char=d.Char||{};bR=d.Lazy=d.Lazy||{};bS=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};bT=d.LazyExtensionsProxy=d.LazyExtensionsProxy||{};bU=bT.LazyRecord=bT.LazyRecord||{};bV=a.console;bW=a.Math;bX=a.IntelliFactory;bY=bX&&bX.Runtime;bZ=a.JSON;b0=a.Date;c.Main=function(){var b1,b2,b3,b4,b5,b6;(function(b7){return b7("loading store");}(function(b7){bV.log(b7);}));p.Start(c.loadStore(),null);(function(b7){return b7("after loadStore");}(function(b7){bV.log(b7);}));b1=(b2=(b3=(b4=(b5=new l.New$1(),(b5.h.push({$:1,$0:"title",$1:"My Shop"}),b5)),(b4.h.push({$:1,$0:"footer",$1:"MyShoppingCart - simple Websharper demo"}),b4)),(b3.h.push({$:0,$0:"main",$1:c.viewItemsToSellAsync()}),b3)),(b2.h.push({$:0,$0:"sidebar",$1:c.viewCartItems()}),b2));b6=D.CompleteHoles(b1.k,b1.h,[]);b1.i=new s.New(b6[1],W.RunFullDocTemplate(b6[0]));};c.loadStore=function(){var b1;b1=null;return p.Delay(function(){return p.Bind((new n.New()).Async("ShoppingCart:ShoppingCart.Server.getStoreInfo:-1467944959",[]),function(b2){((function(b3){return function(b4){return b3("server returned "+a.String(b4)+" families");};}(function(b3){bV.log(b3);}))(f.length(b2)));c.rvStore().Set(z.ofArray(b2));return p.Return(null);});});};c.viewCartItems=function(){t.$cctor();return t.viewCartItems;};c.viewItemsToSellAsync=function(){t.$cctor();return t.viewItemsToSellAsync;};c.rvStore=function(){t.$cctor();return t.rvStore;};c.viewProductFamily=function(b1){var b2,b3,b4,b5,b6,b7;return(b2=(b3=z.map(c.viewProduct,b1.Products),(b4=(b5=new l.New$1(),(b5.h.push({$:1,$0:"familytitle",$1:b1.Title}),b5)),(b4.h.push({$:0,$0:"products",$1:I.Concat(b3)}),b4))),(b6=D.CompleteHoles(b2.k,b2.h,[]),(b7=new s.New(b6[1],J.family(b6[0])),b2.i=b7,b7))).get_Doc();};c.cart=function(){t.$cctor();return t.cart;};c.viewTotalAmount=function(){t.$cctor();return t.viewTotalAmount;};c.viewCartItem=function(b1){var b2,b3,b4,b5,b6,b7,b8,b9,b_,b$;return(b2=(b3=(b4=(b5=(b6=(b7=a.String(b1.Quantity*b1.Item.Price),(b8=(b9=new l.New$1(),(b9.h.push({$:1,$0:"name",$1:b1.Item.Title}),b9)),(b8.h.push({$:1,$0:"amount",$1:b7}),b8))),(b6.h.push({$:1,$0:"quantity",$1:a.String(b1.Quantity)}),b6)),(b5.h.push(D.EventQ2(b5.k,"increment",function(){return b5.i;},function(){c.cart().Lens(b1.Item.Id).Set(G.New(b1.Item,b1.Quantity+1));})),b5)),(b4.h.push(D.EventQ2(b4.k,"decrement",function(){return b4.i;},function(){if(b1.Quantity<=1)c.cart().RemoveByKey(b1.Item.Id);else c.cart().Lens(b1.Item.Id).Set(G.New(b1.Item,b1.Quantity-1));})),b4)),(b3.h.push(D.EventQ2(b3.k,"remove",function(){return b3.i;},function(){c.cart().RemoveByKey(b1.Item.Id);})),b3)),(b_=D.CompleteHoles(b2.k,b2.h,[]),(b$=new s.New(b_[1],J.cartitem(b_[0])),b2.i=b$,b$))).get_Doc();};c.viewProduct=function(b1){var b2,b3,b4,b5,b6,b7,b8,b9;return(b2=(b3=(b4=(b5=(b6=(b7=new l.New$1(),(b7.h.push({$:1,$0:"producttitle",$1:b1.Title}),b7)),(b6.h.push({$:1,$0:"productprice",$1:a.String(b1.Price)}),b6)),(b5.h.push({$:1,$0:"productimgsource",$1:b1.ImageSrc}),b5)),(b4.h.push({$:8,$0:"productquantity",$1:E.Create$1(a.String(1))}),b4)),(b3.h.push(D.EventQ2(b3.k,"addtocart",function(){return b3.i;},function(b_){var b$;if(c.cart().ContainsKey(b1.Id)){b$=E.Lens(c.cart().Lens(b1.Id),function(ca){return ca.Quantity;},function(ca,cb){return G.New(ca.Item,cb);});b$.Set(b$.Get()+e.toInt(a.Number(b_.Vars.Hole("productquantity").$1.Get())));}else if(e.toInt(a.Number(b_.Vars.Hole("productquantity").$1.Get()))!==0)c.cart().Append(G.New(b1,e.toInt(a.Number(b_.Vars.Hole("productquantity").$1.Get()))));})),b3)),(b8=D.CompleteHoles(b2.k,b2.h,[["productquantity",0]]),(b9=new s.New(b8[1],J.product(b8[0])),b2.i=b9,b9))).get_Doc();};e.FailWith=function(b1){throw new bd(b1);};e.toInt=function(b1){var b2;b2=e.toUInt(b1);return b2>=2147483648?b2-4294967296:b2;};e.KeyValue=function(b1){return[b1.K,b1.V];};e.toUInt=function(b1){return(b1<0?bW.ceil(b1):bW.floor(b1))>>>0;};f.length=function(b1){return b1.dims===2?b1.length*b1.length:b1.length;};f.get=function(b1,b2){f.checkBounds(b1,b2);return b1[b2];};f.checkBounds=function(b1,b2){if(b2<0||b2>=b1.length)e.FailWith("Index was outside the bounds of the array.");};f.set=function(b1,b2,b3){f.checkBounds(b1,b2);b1[b2]=b3;};g=d.Obj=bY.Class({Equals:function(b1){return this===b1;},GetHashCode:function(){return -1;}},null,g);g.New=bY.Ctor(function(){},g);l=k.ProviderBuilder=bY.Class({},g,l);l.New$1=bY.Ctor(function(){var b1;g.New.call(this);this.i=null;this.k=(b1=y.NewGuid(),a.String(b1));this.h=[];bY.SetOptional(this,"s",null);},l);n=m.AjaxRemotingProvider=bY.Class({AsyncBase:function(b1,b2){var b3,b4;b3=this;b4=null;return p.Delay(function(){var b5,b6;b5=m.makeHeaders(b1);b6=m.makePayload(b2);return p.Bind(p.GetCT(),function(b7){return p.FromContinuations(function(b8,b9,b_){var b$,ca,cb;function cc(cd){return b$[0]?(b$[0]=false,b_(new be.New(b7))):null;}b$=[true];ca=p.Register(b7,function(){cc();});cb=b3.get_EndPoint();return m.AjaxProvider().Async(cb,b5,b6,function(cd){if(b$[0]){b$[0]=false;ca.Dispose();b8(_1.Activate(bZ.parse(cd)));}},function(cd){if(b$[0]){b$[0]=false;ca.Dispose();b9(cd);}});});});});},get_EndPoint:function(){return m.EndPoint();},Async:function(b1,b2){return this.AsyncBase(b1,b2);},Sync:function(b1,b2){var b3,b4,b5;return _1.Activate(bZ.parse((b3=this.get_EndPoint(),(b4=m.makeHeaders(b1),(b5=m.makePayload(b2),m.AjaxProvider().Sync(b3,b4,b5))))));}},g,n);n.New=bY.Ctor(function(){g.New.call(this);},n);f.choose=function(b1,b2){var b3,b4,b5,b6;b3=[];for(b4=0,b5=b2.length-1;b4<=b5;b4++){b6=b1(b2[b4]);if(b6==null);else b3.push(b6.$0);}return b3;};f.ofSeq=function(b1){var b2,b3;if(b1 instanceof a.Array)return b1.slice();else if(b1 instanceof A)return f.ofList(b1);else{b2=[];b3=_4.Get(b1);try{while(b3.MoveNext())b2.push(b3.Current());return b2;}finally{if(typeof b3=="object"&&"Dispose"in b3)b3.Dispose();}}};f.ofList=function(b1){var b2,b3;b3=[];b2=b1;while(!(b2.$==0)){b3.push(z.head(b2));b2=z.tail(b2);}return b3;};f.tryFindIndex=function(b1,b2){var b3,b4;b3=null;b4=0;while(b4<b2.length&&b3==null){b1(b2[b4])?b3={$:1,$0:b4}:void 0;b4=b4+1;}return b3;};f.tryPick=function(b1,b2){var b3,b4,b5;b3=null;b4=0;while(b4<b2.length&&b3==null){b5=b1(b2[b4]);if(b5!=null&&b5.$==1)b3=b5;b4=b4+1;}return b3;};f.exists=function(b1,b2){var b3,b4,b5,b6;b3=false;b4=0;b6=f.length(b2);while(!b3&&b4<b6)if(b1(b2[b4]))b3=true;else b4=b4+1;return b3;};f.map=function(b1,b2){var b3,b4,b5;b3=new a.Array(b2.length);for(b4=0,b5=b2.length-1;b4<=b5;b4++)b3[b4]=b1(b2[b4]);return b3;};f.concat=function(b1){return a.Array.prototype.concat.apply([],f.ofSeq(b1));};f.filter=function(b1,b2){var b3,b4,b5;b3=[];for(b4=0,b5=b2.length-1;b4<=b5;b4++)if(b1(b2[b4]))b3.push(b2[b4]);return b3;};f.iter=function(b1,b2){var b3,b4;for(b3=0,b4=b2.length-1;b3<=b4;b3++)b1(b2[b3]);};f.foldBack=function(b1,b2,b3){var b4,b5,b6,b7,b8;b4=b3;b6=b2.length;for(b7=1,b8=b6;b7<=b8;b7++)b4=b1(b2[b6-b7],b4);return b4;};f.pick=function(b1,b2){var b3;b3=f.tryPick(b1,b2);return b3==null?e.FailWith("KeyNotFoundException"):b3.$0;};f.find=function(b1,b2){var b3;b3=f.tryFind(b1,b2);return b3==null?e.FailWith("KeyNotFoundException"):b3.$0;};f.forall=function(b1,b2){var b3,b4,b5,b6;b3=true;b4=0;b6=f.length(b2);while(b3&&b4<b6)if(b1(b2[b4]))b4=b4+1;else b3=false;return b3;};f.tryFind=function(b1,b2){var b3,b4;b3=null;b4=0;while(b4<b2.length&&b3==null){b1(b2[b4])?b3={$:1,$0:b2[b4]}:void 0;b4=b4+1;}return b3;};f.create=function(b1,b2){var b3,b4,b5;b3=new a.Array(b1);for(b4=0,b5=b1-1;b4<=b5;b4++)b3[b4]=b2;return b3;};f.init=function(b1,b2){var b3,b4,b5;if(b1<0)e.FailWith("Negative size given.");else null;b3=new a.Array(b1);for(b4=0,b5=b1-1;b4<=b5;b4++)b3[b4]=b2(b4);return b3;};o=h.Var=bY.Class({},g,o);o.New=bY.Ctor(function(){g.New.call(this);},o);p.Start=function(b1,b2){var b3,b4;b3=(b4=(p.defCTS())[0],b2==null?b4:b2.$0);p.scheduler().Fork(function(){if(!b3.c)b1(C.New(function(b5){if(b5.$==1)p.UncaughtAsyncError(b5.$0);},b3));});};p.Delay=function(b1){return function(b2){try{(b1(null))(b2);}catch(b3){b2.k({$:1,$0:b3});}};};p.Bind=function(b1,b2){return p.checkCancel(function(b3){b1(C.New(function(b4){var b5;if(b4.$==0){b5=b4.$0;p.scheduler().Fork(function(){try{(b2(b5))(b3);}catch(b6){b3.k({$:1,$0:b6});}});}else p.scheduler().Fork(function(){b3.k(b4);});},b3.ct));});};p.Return=function(b1){return function(b2){b2.k({$:0,$0:b1});};};p.defCTS=function(){Q.$cctor();return Q.defCTS;};p.UncaughtAsyncError=function(b1){bV.log("WebSharper: Uncaught asynchronous exception",b1);};p.checkCancel=function(b1){return function(b2){if(b2.ct.c)p.cancel(b2);else b1(b2);};};p.scheduler=function(){Q.$cctor();return Q.scheduler;};p.cancel=function(b1){b1.k({$:2,$0:new be.New(b1.ct)});};p.GetCT=function(){Q.$cctor();return Q.GetCT;};p.FromContinuations=function(b1){return function(b2){var b3;function b4(b5){if(b3[0])e.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{b3[0]=true;p.scheduler().Fork(b5);}}b3=[false];b1(function(b5){b4(function(){b2.k({$:0,$0:b5});});},function(b5){b4(function(){b2.k({$:1,$0:b5});});},function(b5){b4(function(){b2.k({$:2,$0:b5});});});};};p.Register=function(b1,b2){var b3;return b1===p.noneCT()?{Dispose:function(){return null;}}:(b3=b1.r.push(b2)-1,{Dispose:function(){return f.set(b1.r,b3,a.ignore);}});};p.noneCT=function(){Q.$cctor();return Q.noneCT;};p.Zero=function(){Q.$cctor();return Q.Zero;};r.NewFromSeq=function(b1){var b2,b3,b4;b2={};b3=_4.Get(b1);try{while(b3.MoveNext()){b4=b3.Current();b2[b4[0]]=b4[1];}}finally{if(typeof b3=="object"&&"Dispose"in b3)b3.Dispose();}return b2;};s=k.TemplateInstance=bY.Class({get_Doc:function(){return this.doc;},Hole:function(b1){return this.allVars.get_Item(b1);}},g,s);s.New=bY.Ctor(function(b1,b2){g.New.call(this);this.doc=b2;this.allVars=b1.$==0?b1.$0:e.FailWith("Should not happen");},s);t.$cctor=function(){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg;t.$cctor=a.ignore;t.store=(new n.New()).Sync("ShoppingCart:ShoppingCart.Server.getStoreInfoSync:-2064226765",[]);t.rvStore=E.Create$1(A.Empty);t.cart=F.Create(function(ch){return ch.Item.Id;},A.Empty);t.viewItemsToSellAsync=(b1=(b2=I.BindView(function(ch){return ch!=null&&ch.$==1?I.Concat(z.map(c.viewProductFamily,ch.$0)):I.Element("p",[],[I.TextNode("loading")]);},H.WithInitOption(c.rvStore().get_View())),(b3=new l.New$1(),(b3.h.push({$:0,$0:"families",$1:b2}),b3))),(b4=D.CompleteHoles(b1.k,b1.h,[]),(b5=new s.New(b4[1],J.itemstosell(b4[0])),b1.i=b5,b5))).get_Doc();t.viewItemsToSell=(b6=(b7=z.map(c.viewProductFamily,c.rvStore().Get()),(b8=new l.New$1(),(b8.h.push({$:0,$0:"families",$1:I.Concat(b7)}),b8))),(b9=D.CompleteHoles(b6.k,b6.h,[]),(b_=new s.New(b9[1],J.itemstosell(b9[0])),b6.i=b_,b_))).get_Doc();t.viewTotalAmount=H.Map(a.String,H.Map(function(ch){return K.sumBy(G.Amount,ch);},c.cart().v));t.viewCartItems=(b$=(ca=(cb=(cc=(cd=I.Convert(c.viewCartItem,c.cart().v),(ce=new l.New$1(),(ce.h.push({$:0,$0:"cartitems",$1:cd}),ce))),(cc.h.push({$:2,$0:"totalamount",$1:c.viewTotalAmount()}),cc)),(cb.h.push(D.EventQ2(cb.k,"checkout",function(){return cb.i;},function(){a.alert("Checkout was called");})),cb)),(ca.h.push(D.EventQ2(ca.k,"emptycart",function(){return ca.i;},function(){c.cart().Clear();})),ca)),(cf=D.CompleteHoles(b$.k,b$.h,[]),(cg=new s.New(cf[1],J.shoppingcart(cf[0])),b$.i=cg,cg))).get_Doc();};v=u.List=bY.Class({GetEnumerator:function(){return _4.Get(this);},GetEnumerator0:function(){return _4.Get0(this);}},null,v);w.Equals=function(b1,b2){var b3,b4,b5,b6;if(b1===b2)return true;else{b3=typeof b1;if(b3=="object"){if(b1===null||b1===void 0||b2===null||b2===void 0)return false;else if("Equals"in b1)return b1.Equals(b2);else if(b1 instanceof a.Array&&b2 instanceof a.Array)return w.arrayEquals(b1,b2);else if(b1 instanceof a.Date&&b2 instanceof a.Date)return w.dateEquals(b1,b2);else{b4=[true];for(var b7 in b1)if(function(b8){b4[0]=!b1.hasOwnProperty(b8)||b2.hasOwnProperty(b8)&&w.Equals(b1[b8],b2[b8]);return!b4[0];}(b7))break;if(b4[0]){for(var b8 in b2)if(function(b9){b4[0]=!b2.hasOwnProperty(b9)||b1.hasOwnProperty(b9);return!b4[0];}(b8))break;}return b4[0];}}else return b3=="function"&&("$Func"in b1?b1.$Func===b2.$Func&&b1.$Target===b2.$Target:"$Invokes"in b1&&"$Invokes"in b2&&w.arrayEquals(b1.$Invokes,b2.$Invokes));}};w.Hash=function(b1){var b2;b2=typeof b1;return b2=="function"?0:b2=="boolean"?b1?1:0:b2=="number"?b1:b2=="string"?w.hashString(b1):b2=="object"?b1==null?0:b1 instanceof a.Array?w.hashArray(b1):w.hashObject(b1):0;};w.arrayEquals=function(b1,b2){var b3,b4;if(f.length(b1)===f.length(b2)){b3=true;b4=0;while(b3&&b4<f.length(b1)){!w.Equals(f.get(b1,b4),f.get(b2,b4))?b3=false:void 0;b4=b4+1;}return b3;}else return false;};w.dateEquals=function(b1,b2){return b1.getTime()===b2.getTime();};w.hashString=function(b1){var b2,b3,b4;if(b1===null)return 0;else{b2=5381;for(b3=0,b4=b1.length-1;b3<=b4;b3++)b2=w.hashMix(b2,b1[b3].charCodeAt());return b2;}};w.hashArray=function(b1){var b2,b3,b4;b2=-34948909;for(b3=0,b4=f.length(b1)-1;b3<=b4;b3++)b2=w.hashMix(b2,w.Hash(f.get(b1,b3)));return b2;};w.hashObject=function(b1){var b2,b3;if("GetHashCode"in b1)return b1.GetHashCode();else{b2=[0];for(var b4 in b1)if(function(b5){b2[0]=w.hashMix(w.hashMix(b2[0],w.hashString(b5)),w.Hash(b1[b5]));return false;}(b4))break;return b2[0];}};w.hashMix=function(b1,b2){return(b1<<5)+b1+b2;};w.Compare=function(b1,b2){var b3,b4,b5,b6,b7,b8;if(b1===b2)return 0;else{b4=typeof b1;switch(b4=="function"?1:b4=="boolean"?2:b4=="number"?2:b4=="string"?2:b4=="object"?3:0){case 0:return typeof b2=="undefined"?0:-1;case 1:return e.FailWith("Cannot compare function values.");case 2:return b1<b2?-1:1;case 3:if(b1===null)b5=-1;else if(b2===null)b5=1;else if("CompareTo"in b1)b5=b1.CompareTo(b2);else if("CompareTo0"in b1)b5=b1.CompareTo0(b2);else if(b1 instanceof a.Array&&b2 instanceof a.Array)b5=w.compareArrays(b1,b2);else if(b1 instanceof a.Date&&b2 instanceof a.Date)b5=w.compareDates(b1,b2);else{b6=[0];for(var b9 in b1)if(function(b_){return!b1.hasOwnProperty(b_)?false:!b2.hasOwnProperty(b_)?(b6[0]=1,true):(b6[0]=w.Compare(b1[b_],b2[b_]),b6[0]!==0);}(b9))break;if(b6[0]===0){for(var b_ in b2)if(function(b$){return!b2.hasOwnProperty(b$)?false:!b1.hasOwnProperty(b$)&&(b6[0]=-1,true);}(b_))break;}b5=b6[0];}return b5;}}};w.compareArrays=function(b1,b2){var b3,b4;if(f.length(b1)<f.length(b2))return -1;else if(f.length(b1)>f.length(b2))return 1;else{b3=0;b4=0;while(b3===0&&b4<f.length(b1)){b3=w.Compare(f.get(b1,b4),f.get(b2,b4));b4=b4+1;}return b3;}};w.compareDates=function(b1,b2){return w.Compare(b1.getTime(),b2.getTime());};y.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new a.RegExp("[xy]","g"),function(b1){var b2,b3;b2=bW.random()*16|0;b3=b1=="x"?b2:b2&3|8;return b3.toString(16);});};A=z.T=bY.Class({GetEnumerator:function(){return new _5.New(this,null,function(b1){var b2;b2=b1.s;return b2.$==0?false:(b1.c=b2.$0,b1.s=b2.$1,true);},void 0);},GetEnumerator0:function(){return _4.Get(this);}},null,A);A.Empty=new A({$:0});z.ofArray=function(b1){var b2,b3,b4;b2=A.Empty;for(b3=f.length(b1)-1,b4=0;b3>=b4;b3--)b2=new A({$:1,$0:f.get(b1,b3),$1:b2});return b2;};z.map=function(b1,b2){var b3,b4,b5,b6,b7;if(b2.$==0)return b2;else{b6=new A({$:1});b3=b6;b4=b2;b5=true;while(b5){b3.$0=b1(b4.$0);b4=b4.$1;if(b4.$==0)b5=false;else b3=(b7=new A({$:1}),b3.$1=b7,b7);}b3.$1=A.Empty;return b6;}};z.head=function(b1){return b1.$==1?b1.$0:z.listEmpty();};z.tail=function(b1){return b1.$==1?b1.$1:z.listEmpty();};z.listEmpty=function(){return e.FailWith("The input list was empty.");};B.New=function(b1,b2){return{c:b1,r:b2};};C.New=function(b1,b2){return{k:b1,ct:b2};};D.CompleteHoles=function(b1,b2,b3){var b5,b6,b7,b8,b9;function b4(b_,b$){var ca;return b6.Contains(b_)?null:(ca=b$===0?U.GetOrAddHoleFor(b1,b_,function(){return{$:8,$0:b_,$1:E.Create$1("")};}):b$===1?U.GetOrAddHoleFor(b1,b_,function(){return{$:13,$0:b_,$1:E.Create$1(0)};}):b$===2?U.GetOrAddHoleFor(b1,b_,function(){return{$:9,$0:b_,$1:E.Create$1(false)};}):e.FailWith("Invalid value type"),(b5.set_Item(b_,ca),{$:1,$0:ca}));}b5=new S.New$5();b6=new T.New$3();b7=_4.Get(b2);try{while(b7.MoveNext()){b8=b7.Current();b9=b8.$0;b6.Add(b9);b5.set_Item(b9,b8);}}finally{if(typeof b7=="object"&&"Dispose"in b7)b7.Dispose();}return[K.append(b2,f.choose(function(b_){return b4(b_[0],b_[1]);},b3)),{$:0,$0:b5}];};D.EventQ2=function(b1,b2,b3,b4){return{$:5,$0:b2,$1:function(b5){return function(b6){return b4({Vars:b3(),Target:b5,Event:b6});};}};};E=h.Var$1=bY.Class({},g,E);E.Create$1=function(b1){return new X.New(false,Y.New({$:2,$0:b1,$1:[]}),b1);};E.Lens=function(b1,b2,b3){var b4,b5,b6;b4=_9.Id();b5=H.Map(b2,b1.get_View());b6=new o({Get:function(){return b2(b1.Get());},Set:function(b7){return b1.Update(function(b8){return b3(b8,b7);});},SetFinal:function(b7){return this.Set(b7);},Update:function(b7){return b1.Update(function(b8){return b3(b8,b7(b2(b8)));});},UpdateMaybe:function(b7){return b1.UpdateMaybe(function(b8){var b9;b9=b7(b2(b8));return b9==null?null:{$:1,$0:b3(b8,b9.$0)};});},get_View:function(){return b5;},get_Id:function(){return b4;}});o.New.call(b6);return b6;};F.Create=function(b1,b2){return F.CreateWithStorage(b1,Z.InMemory(f.ofSeq(b2)));};F.CreateWithStorage=function(b1,b2){return new F.New(b1,b2);};G=c.CartItem=bY.Class({Amount:function(){return this.Item.Price*this.Quantity;}},null,G);G.Amount=function(b1){return b1.Amount();};G.New=function(b1,b2){return new G({Item:b1,Quantity:b2});};H.WithInitOption=function(b1){return H.CreateLazy(function(){return Y.WithInitOption(b1());});};H.Map=function(b1,b2){return H.CreateLazy(function(){return Y.Map(b1,b2());});};H.CreateLazy=function(b1){var b2;b2={c:null,o:b1};return function(){var b3,b4;b3=b2.c;return b3===null?(b3=b2.o(),b2.c=b3,(b4=b3.s,b4!=null&&b4.$==0)?b2.o=null:Y.WhenObsoleteRun(b3,function(){b2.c=null;}),b3):b3;};};H.Map2Unit=function(b1,b2){return H.CreateLazy(function(){return Y.Map2Unit(b1(),b2());});};H.Const=function(b1){var b2;b2=Y.New({$:0,$0:b1});return function(){return b2;};};H.Sink=function(b1,b2){function b3(){Y.WhenRun(b2(),b1,function(){p.scheduler().Fork(b3);});}p.scheduler().Fork(b3);};H.Bind=function(b1,b2){return H.Join(H.Map(b1,b2));};H.MapSeqCached=function(b1,b2){return H.MapSeqCachedBy(a.id,b1,b2);};H.Map3=function(b1,b2,b3,b4){return H.CreateLazy(function(){return Y.Map3(b1,b2(),b3(),b4());});};H.Sequence=function(b1){return H.CreateLazy(function(){return Y.Sequence(K.map(function(b2){return b2();},b1));});};H.Map2=function(b1,b2,b3){return H.CreateLazy(function(){return Y.Map2(b1,b2(),b3());});};H.Join=function(b1){return H.CreateLazy(function(){return Y.Join(b1());});};H.MapSeqCachedBy=function(b1,b2,b3){var b4;b4=[new S.New$5()];return H.Map(function(b5){var b6,b7,b8;b6=b4[0];b7=new S.New$5();b8=_0.mapInPlace(function(b9){var b_,b$;b_=b1(b9);b$=b6.ContainsKey(b_)?b6.get_Item(b_):b2(b9);b7.set_Item(b_,b$);return b$;},f.ofSeq(b5));b4[0]=b7;return b8;},b3);};I=h.Doc=bY.Class({},g,I);I.Concat=function(b1){var b2;b2=_0.ofSeqNonCopying(b1);return _0.TreeReduce(I.get_Empty(),I.Append,b2);};I.BindView=function(b1,b2){return I.EmbedView(H.Map(b1,b2));};I.Append=function(b1,b2){return I.Mk({$:0,$0:b1.docNode,$1:b2.docNode},H.Map2Unit(b1.updates,b2.updates));};I.get_Empty=function(){return I.Mk(null,H.Const());};I.TextNode=function(b1){return I.Mk({$:5,$0:self.document.createTextNode(b1)},H.Const());};I.RunInPlace=function(b1,b2,b3){var b4;b4=bl.CreateRunState(b2,b3.docNode);H.Sink(bm.get_UseAnimations()||bn.BatchUpdatesEnabled()?bo.StartProcessor(bl.PerformAnimatedUpdate(b1,b4,b3.docNode)):function(){bl.PerformSyncUpdate(b1,b4,b3.docNode);},b3.updates);};I.EmbedView=function(b1){var b2;b2=bl.CreateEmbedNode();return I.Mk({$:2,$0:b2},H.Map(a.ignore,H.Bind(function(b3){bl.UpdateEmbedNode(b2,b3.docNode);return b3.updates;},b1)));};I.Mk=function(b1,b2){return new I.New(b1,b2);};I.Element=function(b1,b2,b3){var b4,b5;b4=N.Concat(b2);b5=I.Concat(b3);return bk.New(self.document.createElement(b1),b4,b5);};I.Convert=function(b1,b2){return I.Flatten(H.MapSeqCached(b1,b2));};I.Flatten=function(b1){return I.EmbedView(H.Map(I.Concat,b1));};I.TextView=function(b1){var b2;b2=bl.CreateTextNode();return I.Mk({$:4,$0:b2},H.Map(function(b3){bl.UpdateTextNode(b2,b3);},b1));};I.New=bY.Ctor(function(b1,b2){g.New.call(this);this.docNode=b1;this.updates=b2;},I);J.itemstosell=function(b1){W.LoadLocalTemplates("index");return b1?W.NamedTemplate("index",{$:1,$0:"itemstosell"},b1):void 0;};J.shoppingcart=function(b1){W.LoadLocalTemplates("index");return b1?W.NamedTemplate("index",{$:1,$0:"shoppingcart"},b1):void 0;};J.family=function(b1){W.LoadLocalTemplates("index");return b1?W.NamedTemplate("index",{$:1,$0:"family"},b1):void 0;};J.cartitem=function(b1){W.LoadLocalTemplates("index");return b1?W.NamedTemplate("index",{$:1,$0:"cartitem"},b1):void 0;};J.product=function(b1){W.LoadLocalTemplates("index");return b1?W.NamedTemplate("index",{$:1,$0:"product"},b1):void 0;};F=h.ListModel=bY.Class({Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},Lens:function(b1){return this.LensInto(a.id,function(b2,b3){return b3;},b1);},RemoveByKey:function(b1){var b2;b2=this;this["var"].Set(this.storage.SRemoveIf(function(b3){return w.Equals(b2.key(b3),b1);},this["var"].Get()));this.ObsoleteKey(b1);},ObsoleteAll:function(){K.iter(function(b1){Y.Obsolete(b1.V);},this.it);this.it.Clear();},ContainsKey:function(b1){var b2;b2=this;return f.exists(function(b3){return w.Equals(b2.key(b3),b1);},this["var"].Get());},LensInto:function(b1,b2,b3){return this["LensInto'"](b1,b2,b3,H.Map(b1,this.FindByKeyAsView(b3)));},ObsoleteKey:function(b1){var b2,b3;b2=(b3=null,[this.it.TryGetValue(b1,{get:function(){return b3;},set:function(b4){b3=b4;}}),b3]);if(b2[0]){Y.Obsolete(b2[1]);this.it.Remove(b1);}},Append:function(b1){var b2,b3,b4,b5;b2=this;b3=this["var"].Get();b4=this.key(b1);b5=f.tryFindIndex(function(b6){return w.Equals(b2.key(b6),b4);},b3);if(b5!=null&&b5.$==1)this["var"].Set(this.storage.SSetAt(b5.$0,b1,b3));else this["var"].Set(this.storage.SAppend(b1,b3));this.ObsoleteKey(b4);},"LensInto'":function(b1,b2,b3,b4){var b5,b6,b7;b5=this;b6=_9.Id();b7=new o({Get:function(){return b1(b5.FindByKey(b3));},Set:function(b8){return b5.UpdateBy(function(b9){return{$:1,$0:b2(b9,b8)};},b3);},SetFinal:function(b8){return this.Set(b8);},Update:function(b8){return b5.UpdateBy(function(b9){return{$:1,$0:b2(b9,b8(b1(b9)))};},b3);},UpdateMaybe:function(b8){return b5.UpdateBy(function(b9){var b_;b_=b8(b1(b9));return b_==null?null:{$:1,$0:b2(b9,b_.$0)};},b3);},get_View:function(){return b4;},get_Id:function(){return b6;}});o.New.call(b7);return b7;},FindByKeyAsView:function(b1){return H.Map(function(b2){return b2.$0;},this.TryFindByKeyAsView(b1));},FindByKey:function(b1){var b2;b2=this;return f.find(function(b3){return w.Equals(b2.key(b3),b1);},this["var"].Get());},UpdateBy:function(b1,b2){var b3,b4,b5,b6,b7;b3=this;b4=this["var"].Get();b5=f.tryFindIndex(function(b8){return w.Equals(b3.key(b8),b2);},b4);if(b5!=null&&b5.$==1){b6=b5.$0;b7=b1(f.get(b4,b6));b7!=null&&b7.$==1?(this["var"].Set(this.storage.SSetAt(b6,b7.$0,b4)),this.ObsoleteKey(b2)):void 0;}},TryFindByKeyAsView:function(b1){var b2;b2=this;return function(){var b3,b4,b5;b3=(b4=null,[b2.it.TryGetValue(b1,{get:function(){return b4;},set:function(b6){b4=b6;}}),b4]);return b3[0]?b3[1]:(b5=Y.New({$:2,$0:b2.TryFindByKey(b1),$1:[]}),(b2.it.Add(b1,b5),b5));};},TryFindByKey:function(b1){var b2;b2=this;return f.tryFind(function(b3){return w.Equals(b2.key(b3),b1);},this["var"].Get());},GetEnumerator:function(){return _4.Get(this["var"].Get());},GetEnumerator0:function(){return _4.Get0(this["var"].Get());}},g,F);F.New=bY.Ctor(function(b1,b2){F.New$3.call(this,b1,E.Create$1(f.ofSeq(K.distinctBy(b1,b2.SInit()))),b2);},F);F.New$3=bY.Ctor(function(b1,b2,b3){g.New.call(this);this.key=b1;this["var"]=b2;this.storage=b3;this.v=H.Map(function(b4){return b4.slice();},this["var"].get_View());this.it=new S.New$5();},F);K.sumBy=function(b1,b2){return K.fold(function(b3,b4){return b3+b1(b4);},0,b2);};K.append=function(b1,b2){return{GetEnumerator:function(){var b3,b4;b3=_4.Get(b1);b4=[true];return new _5.New(b3,null,function(b5){var b6;return b5.s.MoveNext()?(b5.c=b5.s.Current(),true):(b6=b5.s,!w.Equals(b6,null)?b6.Dispose():void 0,b5.s=null,b4[0]&&(b4[0]=false,b5.s=_4.Get(b2),b5.s.MoveNext()?(b5.c=b5.s.Current(),true):(b5.s.Dispose(),b5.s=null,false)));},function(b5){var b6;b6=b5.s;if(!w.Equals(b6,null))b6.Dispose();});}};};K.fold=function(b1,b2,b3){var b4,b5;b4=b2;b5=_4.Get(b3);try{while(b5.MoveNext())b4=b1(b4,b5.Current());return b4;}finally{if(typeof b5=="object"&&"Dispose"in b5)b5.Dispose();}};K.iter=function(b1,b2){var b3;b3=_4.Get(b2);try{while(b3.MoveNext())b1(b3.Current());}finally{if(typeof b3=="object"&&"Dispose"in b3)b3.Dispose();}};K.distinctBy=function(b1,b2){return{GetEnumerator:function(){var b3,b4;b3=_4.Get(b2);b4=new T.New$3();return new _5.New(null,null,function(b5){var b6,b7;if(b3.MoveNext()){b6=b3.Current();b7=b4.Add(b1(b6));while(!b7&&b3.MoveNext()){b6=b3.Current();b7=b4.Add(b1(b6));}return b7&&(b5.c=b6,true);}else return false;},function(){b3.Dispose();});}};};K.head=function(b1){var b2;b2=_4.Get(b1);try{return b2.MoveNext()?b2.Current():K.insufficient();}finally{if(typeof b2=="object"&&"Dispose"in b2)b2.Dispose();}};K.map=function(b1,b2){return{GetEnumerator:function(){var b3;b3=_4.Get(b2);return new _5.New(null,null,function(b4){return b3.MoveNext()&&(b4.c=b1(b3.Current()),true);},function(){b3.Dispose();});}};};K.max=function(b1){var b2,b3,b4;b2=_4.Get(b1);try{if(!b2.MoveNext())K.seqEmpty();b3=b2.Current();while(b2.MoveNext()){b4=b2.Current();if(w.Compare(b4,b3)===1)b3=b4;}return b3;}finally{if(typeof b2=="object"&&"Dispose"in b2)b2.Dispose();}};K.seqEmpty=function(){return e.FailWith("The input sequence was empty.");};K.forall=function(b1,b2){return!K.exists(function(b3){return!b1(b3);},b2);};K.exists=function(b1,b2){var b3,b4;b3=_4.Get(b2);try{b4=false;while(!b4&&b3.MoveNext())b4=b1(b3.Current());return b4;}finally{if(typeof b3=="object"&&"Dispose"in b3)b3.Dispose();}};L.GetFieldValues=function(b1){var b2,b3;b2=[];for(var b4 in b1)b2.push(b1[b4]);return b2;};H=h.View=bY.Class({},null,H);N=h.AttrProxy=bY.Class({},null,N);N.Concat=function(b1){var b2;b2=_0.ofSeqNonCopying(b1);return _0.TreeReduce(bt.EmptyAttr(),N.Append,b2);};N.Handler=function(b1,b2){return N.HandlerImpl(b1,b2);};N.Create=function(b1,b2){return bt.Static(function(b3){b3.setAttribute(b1,b2);});};N.Append=function(b1,b2){return bt.AppendTree(b1,b2);};N.HandlerImpl=function(b1,b2){return bt.Static(function(b3){b3.addEventListener(b1,function(b4){return(b2(b3))(b4);},false);});};O=h.CheckedInput=bY.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,O);P.TryParseInt32=function(b1,b2){return P.TryParse(b1,-2147483648,2147483647,b2);};Q.$cctor=function(){Q.$cctor=a.ignore;Q.noneCT=B.New(false,[]);Q.scheduler=new R.New();Q.defCTS=[new _2.New()];Q.Zero=p.Return();Q.GetCT=function(b1){b1.k({$:0,$0:b1.ct});};};R=p.Scheduler=bY.Class({Fork:function(b1){var b2;b2=this;this.robin.push(b1);if(this.idle){this.idle=false;a.setTimeout(function(){b2.tick();},0);}},tick:function(){var b1,b2,b3;b2=this;b3=b0.now();b1=true;while(b1)if(this.robin.length===0){this.idle=true;b1=false;}else{(this.robin.shift())();b0.now()-b3>40?(a.setTimeout(function(){b2.tick();},0),b1=false):void 0;}}},g,R);R.New=bY.Ctor(function(){g.New.call(this);this.idle=true;this.robin=[];},R);S=u.Dictionary=bY.Class({set_Item:function(b1,b2){this.set(b1,b2);},set:function(b1,b2){var b3,b4,b5,b6;b3=this;b4=this.hash(b1);b5=this.data[b4];if(b5==null){this.count=this.count+1;this.data[b4]=new a.Array({K:b1,V:b2});}else{b6=f.tryFindIndex(function(b7){return b3.equals.apply(null,[(e.KeyValue(b7))[0],b1]);},b5);b6==null?(this.count=this.count+1,b5.push({K:b1,V:b2})):b5[b6.$0]={K:b1,V:b2};}},TryGetValue:function(b1,b2){var b3,b4,b5;b3=this;b4=this.data[this.hash(b1)];return b4==null?false:(b5=f.tryPick(function(b6){var b7;b7=e.KeyValue(b6);return b3.equals.apply(null,[b7[0],b1])?{$:1,$0:b7[1]}:null;},b4),b5!=null&&b5.$==1&&(b2.set(b5.$0),true));},Clear:function(){this.data=[];this.count=0;},ContainsKey:function(b1){var b2,b3;b2=this;b3=this.data[this.hash(b1)];return b3==null?false:f.exists(function(b4){return b2.equals.apply(null,[(e.KeyValue(b4))[0],b1]);},b3);},get_Item:function(b1){return this.get(b1);},get_Values:function(){return new bw.New(this);},Remove:function(b1){return this.remove(b1);},get_Keys:function(){return new bE.New(this);},get:function(b1){var b2,b3;b2=this;b3=this.data[this.hash(b1)];return b3==null?_3.notPresent():f.pick(function(b4){var b5;b5=e.KeyValue(b4);return b2.equals.apply(null,[b5[0],b1])?{$:1,$0:b5[1]}:null;},b3);},remove:function(b1){var b2,b3,b4,b5;b2=this;b3=this.hash(b1);b4=this.data[b3];return b4==null?false:(b5=f.filter(function(b6){return!b2.equals.apply(null,[(e.KeyValue(b6))[0],b1]);},b4),f.length(b5)<b4.length&&(this.count=this.count-1,this.data[b3]=b5,true));},Add:function(b1,b2){this.add(b1,b2);},add:function(b1,b2){var b3,b4,b5;b3=this;b4=this.hash(b1);b5=this.data[b4];if(b5==null){this.count=this.count+1;this.data[b4]=new a.Array({K:b1,V:b2});}else{f.exists(function(b6){return b3.equals.apply(null,[(e.KeyValue(b6))[0],b1]);},b5)?_3.alreadyAdded():void 0;this.count=this.count+1;b5.push({K:b1,V:b2});}},GetEnumerator:function(){return _4.Get0(this);},GetEnumerator0:function(){return _4.Get0(f.concat(L.GetFieldValues(this.data)));}},g,S);S.New$5=bY.Ctor(function(){S.New$6.call(this,[],w.Equals,w.Hash);},S);S.New$6=bY.Ctor(function(b1,b2,b3){var b4,b5;g.New.call(this);this.equals=b2;this.hash=b3;this.count=0;this.data=[];b4=_4.Get(b1);try{while(b4.MoveNext()){b5=b4.Current();this.set(b5.K,b5.V);}}finally{if(typeof b4=="object"&&"Dispose"in b4)b4.Dispose();}},S);T=u.HashSet=bY.Class({Add:function(b1){return this.add(b1);},Contains:function(b1){var b2;b2=this.data[this.hash(b1)];return b2==null?false:this.arrContains(b1,b2);},add:function(b1){var b2,b3;b2=this.hash(b1);b3=this.data[b2];return b3==null?(this.data[b2]=[b1],this.count=this.count+1,true):this.arrContains(b1,b3)?false:(b3.push(b1),this.count=this.count+1,true);},arrContains:function(b1,b2){var b3,b4,b5,b6;b3=true;b4=0;b6=b2.length;while(b3&&b4<b6)if(this.equals.apply(null,[b2[b4],b1]))b3=false;else b4=b4+1;return!b3;},ExceptWith:function(b1){var b2;b2=_4.Get(b1);try{while(b2.MoveNext())this.Remove(b2.Current());}finally{if(typeof b2=="object"&&"Dispose"in b2)b2.Dispose();}},get_Count:function(){return this.count;},CopyTo:function(b1){var b2,b3,b4,b5;b2=0;b3=bD.concat(this.data);for(b4=0,b5=b3.length-1;b4<=b5;b4++)f.set(b1,b4,b3[b4]);},IntersectWith:function(b1){var b2,b3,b4,b5,b6;b2=new T.New$4(b1,this.equals,this.hash);b3=bD.concat(this.data);for(b4=0,b5=b3.length-1;b4<=b5;b4++){b6=b3[b4];if(!b2.Contains(b6))this.Remove(b6);}},Remove:function(b1){var b2;b2=this.data[this.hash(b1)];return b2==null?false:this.arrRemove(b1,b2)&&(this.count=this.count-1,true);},arrRemove:function(b1,b2){var b3,b4,b5,b6;b3=true;b4=0;b6=b2.length;while(b3&&b4<b6)if(this.equals.apply(null,[b2[b4],b1])){b2.splice.apply(b2,[b4,1]);b3=false;}else b4=b4+1;return!b3;},GetEnumerator:function(){return _4.Get(bD.concat(this.data));},GetEnumerator0:function(){return _4.Get(bD.concat(this.data));}},g,T);T.New$3=bY.Ctor(function(){T.New$4.call(this,[],w.Equals,w.Hash);},T);T.New$4=bY.Ctor(function(b1,b2,b3){var b4;g.New.call(this);this.equals=b2;this.hash=b3;this.data=[];this.count=0;b4=_4.Get(b1);try{while(b4.MoveNext())this.add(b4.Current());}finally{if(typeof b4=="object"&&"Dispose"in b4)b4.Dispose();}},T);T.New$2=bY.Ctor(function(b1){T.New$4.call(this,b1,w.Equals,w.Hash);},T);U.$cctor=function(){U.$cctor=a.ignore;U.initialized=new S.New$5();};U=k.TemplateInitializer=bY.Class({},g,U);U.GetOrAddHoleFor=function(b1,b2,b3){var b4,b5,b6,b7;U.$cctor();b4=U.GetHolesFor(b1);b5=(b6=null,[b4.TryGetValue(b2,{get:function(){return b6;},set:function(b8){b6=b8;}}),b6]);return b5[0]?b5[1]:(b7=b3(),(b4.set_Item(b2,b7),b7));};U.GetHolesFor=function(b1){var b2,b3,b4;U.$cctor();b2=(b3=null,[U.initialized.TryGetValue(b1,{get:function(){return b3;},set:function(b5){b3=b5;}}),b3]);return b2[0]?b2[1]:(b4=new S.New$5(),(U.initialized.set_Item(b1,b4),b4));};W.RunFullDocTemplate=function(b1){var b2,b3,b4;return W.RenderedFullDocTemplate()==null?(b2=(W.LoadLocalTemplates(""),W.PrepareTemplateStrict("",null,self.document.body,null),b3=W.ChildrenTemplate(self.document.body,b1),b4=self.document.body,function(b5){I.RunInPlace(true,b4,b5);}(b3),b3),(W.set_RenderedFullDocTemplate({$:1,$0:b2}),b2)):W.RenderedFullDocTemplate().$0;};W.RenderedFullDocTemplate=function(){bg.$cctor();return bg.RenderedFullDocTemplate;};W.LoadLocalTemplates=function(b1){!W.LocalTemplatesLoaded()?(W.set_LocalTemplatesLoaded(true),W.LoadNestedTemplates(self.document.body,"")):void 0;W.LoadedTemplates().set_Item(b1,W.LoadedTemplateFile(""));};W.PrepareTemplateStrict=function(b1,b2,b3,b4){var b5;function b6(ca,cb){var cc,cd,ce,cf,cg,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC;function ch(cD){}while(true)switch(ca){case 0:if(cb!==null){cc=cb.nextSibling;if(w.Equals(cb.nodeType,_7.TEXT_NODE))bh.convertTextNode(cb);else if(w.Equals(cb.nodeType,_7.ELEMENT_NODE))b8(cb);cb=cc;}else return null;break;case 1:ci=bi.string(cb.nodeName,{$:1,$0:3},null).toLowerCase();cj=(cd=ci.indexOf("."),cd===-1?[b1,ci]:[bi.string(ci,null,{$:1,$0:cd-1}),bi.string(ci,{$:1,$0:cd+1},null)]);ck=cj[1];cl=cj[0];if(cl!==""&&!W.LoadedTemplates().ContainsKey(cl))return bh.failNotLoaded(ck);else{if(cl===""&&b4!=null)b4.$0(ck);cm=W.LoadedTemplates().get_Item(cl);if(!cm.ContainsKey(ck))return bh.failNotLoaded(ck);else{cn=cm.get_Item(ck);co=cn.cloneNode(true);cp=new T.New$3();cq=new S.New$5();cr=cb.attributes;for(cs=0,ct=cr.length-1;cs<=ct;cs++){cu=cr.item(cs).name.toLowerCase();cq.set_Item(cu,(cv=cr.item(cs).nodeValue,cv===""?cu:cv.toLowerCase()));if(!cp.Add(cu))bV.warn("Hole mapped twice",cu);}for(cw=0,cx=cb.childNodes.length-1;cw<=cx;cw++){cy=cb.childNodes[cw];if(w.Equals(cy.nodeType,_7.ELEMENT_NODE))!cp.Add(cy.nodeName.toLowerCase())?bV.warn("Hole filled twice",ck):void 0;}cz=cb.childNodes.length===1&&w.Equals(cb.firstChild.nodeType,_7.TEXT_NODE);if(cz){cf=bh.fillTextHole(co,cb.firstChild.textContent,ck);((function(cD){return function(cE){if(cE!=null)cD(cE.$0);};}((cg=function(cD){return function(cE){return cD.Add(cE);};}(cp),function(cD){return ch(cg(cD));})))(cf));}bh.removeHolesExcept(co,cp);if(!cz){for(cA=0,cB=cb.childNodes.length-1;cA<=cB;cA++){cC=cb.childNodes[cA];if(w.Equals(cC.nodeType,_7.ELEMENT_NODE))cC.hasAttributes()?bh.fillInstanceAttrs(co,cC):b7(co,cC);}}bh.mapHoles(co,cq);bh.fill(co,cb.parentNode,cb);cb.parentNode.removeChild(cb);return;}}break;}}function b7(ca,cb){var cc,ce,cf;function cd(cg,ch){var ci;if(ce==="title"&&cb.hasChildNodes()){ci=ba.ParseHTMLIntoFakeRoot(cb.textContent);cb.removeChild(cb.firstChild);while(ci.hasChildNodes())cb.appendChild(ci.firstChild);}else null;b8(cb);return bh.fill(cb,cg,ch);}ce=cb.nodeName.toLowerCase();W.foreachNotPreserved(ca,"[ws-attr-holes]",function(cg){var ch,ci,cj,ck,cl;ch=bs.SplitChars(cg.getAttribute("ws-attr-holes"),[" "],1);for(ci=0,cj=ch.length-1;ci<=cj;ci++){ck=f.get(ch,ci);cg.setAttribute(ck,(cl=new a.RegExp("\\${"+ce+"}","ig"),cg.getAttribute(ck).replace(cl,cb.textContent)));}});cf=ca.querySelector("[ws-hole="+ce+"]");if(w.Equals(cf,null)){cc=ca.querySelector("[ws-replace="+ce+"]");return w.Equals(cc,null)?null:(cd(cc.parentNode,cc),void cc.parentNode.removeChild(cc));}else{while(cf.hasChildNodes())cf.removeChild(cf.lastChild);cf.removeAttribute("ws-hole");return cd(cf,null);}}function b8(ca){if(!ca.hasAttribute("ws-preserve"))if(bs.StartsWith(ca.nodeName.toLowerCase(),"ws-"))b_(ca);else{bh.convertAttrs(ca);b9(ca.firstChild);}}function b9(ca){return b6(0,ca);}function b_(ca){return b6(1,ca);}function b$(ca){var cb,cc,cd,ce;while(true){cb=ca.querySelector("[ws-template]");if(w.Equals(cb,null)){cc=ca.querySelector("[ws-children-template]");if(w.Equals(cc,null))return null;else{cd=cc.getAttribute("ws-children-template");cc.removeAttribute("ws-children-template");W.PrepareTemplateStrict(b1,{$:1,$0:cd},cc,null);ca=ca;}}else{ce=cb.getAttribute("ws-template");(W.PrepareSingleTemplate(b1,{$:1,$0:ce},cb))(null);ca=ca;}}}b5=(b2==null?"":b2.$0).toLowerCase();W.LoadedTemplateFile(b1).set_Item(b5,b3);if(b3.hasChildNodes()){b$(b3);b9(b3.firstChild);}};W.ChildrenTemplate=function(b1,b2){var b3,b4,b5,b6,b7;b3=W.InlineTemplate(b1,K.append(b2,W.GlobalHoles().get_Values()));b4=b3[1];b5=b3[0];b6=b5.Els;return!w.Equals(b6,null)&&b6.length===1&&(f.get(b6,0)instanceof _7&&(w.Equals(f.get(b6,0).nodeType,_7.ELEMENT_NODE)&&(b7=f.get(b6,0),true)))?bk.TreeNode(b5,b4):I.Mk({$:6,$0:b5},b4);};W.set_RenderedFullDocTemplate=function(b1){bg.$cctor();bg.RenderedFullDocTemplate=b1;};W.NamedTemplate=function(b1,b2,b3){var b4,b5;b4=(b5=null,[W.LoadedTemplateFile(b1).TryGetValue(b2==null?"":b2.$0,{get:function(){return b5;},set:function(b6){b5=b6;}}),b5]);return b4[0]?W.ChildrenTemplate(b4[1].cloneNode(true),b3):(bV.warn("Local template doesn't exist",b2),I.get_Empty());};W.LocalTemplatesLoaded=function(){bg.$cctor();return bg.LocalTemplatesLoaded;};W.set_LocalTemplatesLoaded=function(b1){bg.$cctor();bg.LocalTemplatesLoaded=b1;};W.LoadNestedTemplates=function(b1,b2){var b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce;function b3(cf){var cg,ch;if(!b4.ContainsKey(cf)){cg=(ch=null,[b5.TryGetValue(cf,{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);if(cg[0]){ce.Add(cf);b5.Remove(cf);W.PrepareTemplateStrict(b2,{$:1,$0:cf},cg[1],{$:1,$0:b3});}else bV.warn(ce.Contains(cf)?"Encountered loop when instantiating "+cf:"Local template does not exist: "+cf);}}b4=W.LoadedTemplateFile(b2);b5=new S.New$5();b6=b1.querySelectorAll("[ws-template]");for(b7=0,b8=b6.length-1;b7<=b8;b7++){b9=b6[b7];b_=b9.getAttribute("ws-template").toLowerCase();b9.removeAttribute("ws-template");b5.set_Item(b_,W.FakeRootSingle(b9));}b$=b1.querySelectorAll("[ws-children-template]");for(ca=0,cb=b$.length-1;ca<=cb;ca++){cc=b$[ca];cd=cc.getAttribute("ws-children-template").toLowerCase();cc.removeAttribute("ws-children-template");b5.set_Item(cd,W.FakeRoot(cc));}ce=new T.New$3();while(b5.count>0)b3(K.head(b5.get_Keys()));};W.LoadedTemplates=function(){bg.$cctor();return bg.LoadedTemplates;};W.LoadedTemplateFile=function(b1){var b2,b3,b4;b2=(b3=null,[W.LoadedTemplates().TryGetValue(b1,{get:function(){return b3;},set:function(b5){b3=b5;}}),b3]);return b2[0]?b2[1]:(b4=new S.New$5(),(W.LoadedTemplates().set_Item(b1,b4),b4));};W.foreachNotPreserved=function(b1,b2,b3){ba.IterSelector(b1,b2,function(b4){if(b4.closest("[ws-preserve]")==null)b3(b4);});};W.PrepareSingleTemplate=function(b1,b2,b3){var b4;b4=W.FakeRootSingle(b3);return function(b5){W.PrepareTemplateStrict(b1,b2,b4,b5);};};W.InlineTemplate=function(b1,b2){var b3,b4,b5,b6,b9,b_,b$,ca,cb,cc,cd;function b7(ce,cf){var cg,ch,ci;cg=bt.Insert(ce,cf);b_.push(bt.Updates(cg));b$.push([ce,cg]);ch=bY.GetOptional(cg.OnAfterRender);return ch==null?null:(ci=ch.$0,void ca.push(function(){ci(ce);}));}function b8(ce){var cf,cg;cf=(cg=null,[cb.TryGetValue(ce,{get:function(){return cg;},set:function(ch){cg=ch;}}),cg]);return cf[0]?cf[1].$==0?{$:1,$0:cf[1].$1}:cf[1].$==1?{$:1,$0:I.TextNode(cf[1].$1)}:cf[1].$==2?{$:1,$0:I.TextView(cf[1].$1)}:cf[1].$==8?{$:1,$0:I.TextView(cf[1].$1.get_View())}:cf[1].$==9?{$:1,$0:I.TextView(H.Map(a.String,cf[1].$1.get_View()))}:cf[1].$==10?{$:1,$0:I.TextView(H.Map(function(ch){return ch.get_Input();},cf[1].$1.get_View()))}:cf[1].$==11?{$:1,$0:I.TextView(H.Map(a.String,cf[1].$1.get_View()))}:cf[1].$==12?{$:1,$0:I.TextView(H.Map(function(ch){return ch.get_Input();},cf[1].$1.get_View()))}:cf[1].$==13?{$:1,$0:I.TextView(H.Map(a.String,cf[1].$1.get_View()))}:(bV.warn("Content hole filled with attribute data",ce),null):null;}b9=[];b_=[];b$=[];ca=[];cb=new S.New$5();cc=_4.Get(b2);try{while(cc.MoveNext()){cd=cc.Current();cb.set_Item(cd.$0,cd);}}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}b3=ba.ChildrenArray(b1);W.foreachNotPreserved(b1,"[ws-hole]",function(ce){var cf,cg,ch;ch=ce.getAttribute("ws-hole");ce.removeAttribute("ws-hole");while(ce.hasChildNodes())ce.removeChild(ce.lastChild);cf=b8(ch);if(cf!=null&&cf.$==1){cg=cf.$0;bl.LinkElement(ce,cg.docNode);b9.push(bb.New(bt.Empty(ce),cg.docNode,null,ce,_9.Int(),null));b_.push(cg.updates);}});W.foreachNotPreserved(b1,"[ws-replace]",function(ce){var cf,cg,ch,ci,cj,ck;cf=b8(ce.getAttribute("ws-replace"));if(cf!=null&&cf.$==1){cg=cf.$0;ch=ce.parentNode;ci=self.document.createTextNode("");ch.replaceChild(ci,ce);cj=bl.InsertBeforeDelim(ci,cg.docNode);ck=f.tryFindIndex(function(cl){return ce===cl;},b3);ck==null?void 0:f.set(b3,ck.$0,cg.docNode);b9.push(bb.New(bt.Empty(ch),cg.docNode,{$:1,$0:[cj,ci]},ch,_9.Int(),null));b_.push(cg.updates);}});W.foreachNotPreserved(b1,"[ws-attr]",function(ce){var cf,cg,ch;cf=ce.getAttribute("ws-attr");ce.removeAttribute("ws-attr");cg=(ch=null,[cb.TryGetValue(cf,{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);if(cg[0])cg[1].$==3?b7(ce,cg[1].$1):bV.warn("Attribute hole filled with non-attribute data",cf);});W.foreachNotPreserved(b1,"[ws-on]",function(ce){b7(ce,N.Concat(f.choose(function(cf){var cg,ch,ci;cg=bs.SplitChars(cf,[":"],1);ch=(ci=null,[cb.TryGetValue(f.get(cg,1),{get:function(){return ci;},set:function(cj){ci=cj;}}),ci]);return ch[0]?ch[1].$==4?{$:1,$0:bu.Handler(f.get(cg,0),ch[1].$1)}:ch[1].$==5?{$:1,$0:N.Handler(f.get(cg,0),ch[1].$1)}:(bV.warn("Event hole on"+f.get(cg,0)+" filled with non-event data",f.get(cg,1)),null):null;},bs.SplitChars(ce.getAttribute("ws-on"),[" "],1))));ce.removeAttribute("ws-on");});W.foreachNotPreserved(b1,"[ws-onafterrender]",function(ce){var cf,cg,ch;cf=ce.getAttribute("ws-onafterrender");cg=(ch=null,[cb.TryGetValue(cf,{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);if(cg[0])cg[1].$==6?(ce.removeAttribute("ws-onafterrender"),b7(ce,bu.OnAfterRender(cg[1].$1))):cg[1].$==7?(ce.removeAttribute("ws-onafterrender"),b7(ce,bu.OnAfterRender(cg[1].$1))):bV.warn("onafterrender hole filled with non-onafterrender data",cf);});W.foreachNotPreserved(b1,"[ws-var]",function(ce){var cf,cg,ch;cf=ce.getAttribute("ws-var");ce.removeAttribute("ws-var");cg=(ch=null,[cb.TryGetValue(cf,{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);if(cg[0])cg[1].$==8?b7(ce,bu.Value(cg[1].$1)):cg[1].$==9?b7(ce,bu.Checked(cg[1].$1)):cg[1].$==10?b7(ce,bu.IntValue(cg[1].$1)):cg[1].$==11?b7(ce,bu.IntValueUnchecked(cg[1].$1)):cg[1].$==12?b7(ce,bu.FloatValue(cg[1].$1)):cg[1].$==13?b7(ce,bu.FloatValueUnchecked(cg[1].$1)):bV.warn("Var hole filled with non-Var data",cf);});W.foreachNotPreserved(b1,"[ws-attr-holes]",function(ce){var cf,cg,ch,ci;cf=new a.RegExp(W.TextHoleRE(),"g");cg=bs.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);ce.removeAttribute("ws-attr-holes");for(ch=0,ci=cg.length-1;ch<=ci;ch++)(function(){var cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;cs=f.get(cg,ch);ct=ce.getAttribute(cs);cj=null;ck=0;cu=[];while(cj=cf.exec(ct),cj!==null){cv=bi.string(ct,{$:1,$0:ck},{$:1,$0:cf.lastIndex-f.get(cj,0).length-1});ck=cf.lastIndex;cu.push([cv,f.get(cj,1)]);}cm=bi.string(ct,{$:1,$0:ck},null);cf.lastIndex=0;cn=f.foldBack(function(cw,cx){return(function(cy){var cz,cA;cz=cy[0];cA=cy[1];return function(cB){var cC,cD,cE,cF,cG;cC=cB[0];cD=cB[1];cE=(cF=(cG=null,[cb.TryGetValue(cA,{get:function(){return cG;},set:function(cH){cG=cH;}}),cG]),cF[0]?cF[1].$==1?{$:0,$0:cF[1].$1}:cF[1].$==2?{$:1,$0:cF[1].$1}:cF[1].$==8?{$:1,$0:cF[1].$1.get_View()}:cF[1].$==9?{$:1,$0:H.Map(a.String,cF[1].$1.get_View())}:cF[1].$==10?{$:1,$0:H.Map(function(cH){return cH.get_Input();},cF[1].$1.get_View())}:cF[1].$==11?{$:1,$0:H.Map(a.String,cF[1].$1.get_View())}:cF[1].$==12?{$:1,$0:H.Map(function(cH){return cH.get_Input();},cF[1].$1.get_View())}:cF[1].$==13?{$:1,$0:H.Map(a.String,cF[1].$1.get_View())}:(bV.warn("Attribute value hole filled with non-text data",cA),{$:0,$0:""}):{$:0,$0:""});return cE.$==1?[cz,new A({$:1,$0:cC===""?cE.$0:H.Map(function(cH){return cH+cC;},cE.$0),$1:cD})]:[cz+cE.$0+cC,cD];};}(cw))(cx);},cu,[cm,A.Empty]);return b7(ce,cn[1].$==1?cn[1].$1.$==1?cn[1].$1.$1.$==1?cn[1].$1.$1.$1.$==0?(co=cn[0],bu.Dynamic(cs,H.Map3(function(cw,cx,cy){return co+cw+cx+cy;},cn[1].$0,cn[1].$1.$0,cn[1].$1.$1.$0))):(cp=cn[0],bu.Dynamic(cs,H.Map(function(cw){return cp+bs.concat("",cw);},H.Sequence(cn[1])))):(cq=cn[0],bu.Dynamic(cs,H.Map2(function(cw,cx){return cq+cw+cx;},cn[1].$0,cn[1].$1.$0))):cn[0]===""?bu.Dynamic(cs,cn[1].$0):(cr=cn[0],bu.Dynamic(cs,H.Map(function(cw){return cr+cw;},cn[1].$0))):N.Create(cs,cn[0]));}());});return[bY.DeleteEmptyFields({Els:b3,Dirty:true,Holes:b9,Attrs:b$,Render:(b4=ca.length==0?null:{$:1,$0:function(ce){f.iter(function(cf){cf(ce);},ca);}},b4?b4.$0:void 0),El:(b5=!w.Equals(b3,null)&&b3.length===1&&(f.get(b3,0)instanceof _7&&(f.get(b3,0)instanceof a.Element&&(b6=f.get(b3,0),true)))?{$:1,$0:b6}:null,b5?b5.$0:void 0)},["Render","El"]),_0.TreeReduce(H.Const(),H.Map2Unit,b_)];};W.GlobalHoles=function(){bg.$cctor();return bg.GlobalHoles;};W.FakeRootSingle=function(b1){var b2,b3,b4,b5;b1.removeAttribute("ws-template");b2=b1.getAttribute("ws-replace");if(b2===null);else{b1.removeAttribute("ws-replace");b3=b1.parentNode;w.Equals(b3,null)?void 0:(b4=self.document.createElement(b1.tagName),b4.setAttribute("ws-replace",b2),b3.replaceChild(b4,b1));}b5=self.document.createElement("div");b5.appendChild(b1);return b5;};W.FakeRoot=function(b1){var b2;b2=self.document.createElement("div");while(b1.hasChildNodes())b2.appendChild(b1.firstChild);return b2;};W.TextHoleRE=function(){bg.$cctor();return bg.TextHoleRE;};X=h.ConcreteVar=bY.Class({Set:function(b1){if(this.isConst)(function(b2){return b2("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b2){bV.log(b2);}));else{Y.Obsolete(this.snap);this.current=b1;this.snap=Y.New({$:2,$0:b1,$1:[]});}},get_View:function(){return this.view;},Get:function(){return this.current;},Update:function(b1){this.Set(b1(this.Get()));},UpdateMaybe:function(b1){var b2;b2=b1(this.Get());if(b2!=null&&b2.$==1)this.Set(b2.$0);}},o,X);X.New=bY.Ctor(function(b1,b2,b3){var b4;b4=this;o.New.call(this);this.isConst=b1;this.current=b3;this.snap=b2;this.view=function(){return b4.snap;};this.id=_9.Int();},X);Y.WithInitOption=function(b1){var b2,b3,b4;b2=b1.s;return b2==null?Y.New(null):b2!=null&&b2.$==2?(b3=Y.New({$:2,$0:{$:1,$0:b2.$0},$1:[]}),(Y.WhenObsolete(b1,b3),b3)):b2!=null&&b2.$==3?(b4=Y.New({$:2,$0:null,$1:[]}),(Y.When(b1,function(){Y.Obsolete(b4);},b4),b4)):Y.New({$:0,$0:{$:1,$0:b2.$0}});};Y.Map=function(b1,b2){var b3,b4;b3=b2.s;return b3!=null&&b3.$==0?Y.New({$:0,$0:b1(b3.$0)}):(b4=Y.New({$:3,$0:[],$1:[]}),(Y.When(b2,function(b5){Y.MarkDone(b4,b2,b1(b5));},b4),b4));};Y.WhenObsoleteRun=function(b1,b2){var b3;b3=b1.s;if(b3==null)b2();else b3!=null&&b3.$==2?b3.$1.push(b2):b3!=null&&b3.$==3?b3.$1.push(b2):void 0;};Y.WhenObsolete=function(b1,b2){var b3;b3=b1.s;if(b3==null)Y.Obsolete(b2);else b3!=null&&b3.$==2?Y.EnqueueSafe(b3.$1,b2):b3!=null&&b3.$==3?Y.EnqueueSafe(b3.$1,b2):void 0;};Y.When=function(b1,b2,b3){var b4;b4=b1.s;if(b4==null)Y.Obsolete(b3);else b4!=null&&b4.$==2?(Y.EnqueueSafe(b4.$1,b3),b2(b4.$0)):b4!=null&&b4.$==3?(b4.$0.push(b2),Y.EnqueueSafe(b4.$1,b3)):b2(b4.$0);};Y.MarkDone=function(b1,b2,b3){var b4;if(b4=b2.s,b4!=null&&b4.$==0)Y.MarkForever(b1,b3);else Y.MarkReady(b1,b3);};Y.EnqueueSafe=function(b1,b2){var b3,b4,b5,b6;b1.push(b2);if(b1.length%20===0){b3=b1.slice(0);bJ.Clear(b1);for(b4=0,b5=f.length(b3)-1;b4<=b5;b4++){b6=f.get(b3,b4);if(typeof b6=="object")(function(b7){if(b7.s)b1.push(b7);}(b6));else(function(b7){b1.push(b7);}(b6));}}else void 0;};Y.Map2Unit=function(b1,b2){var b3,b4,b5;function b6(){var b7,b8,b9;if(!(b7=b5.s,b7!=null&&b7.$==0||b7!=null&&b7.$==2)){b8=Y.ValueAndForever(b1);b9=Y.ValueAndForever(b2);if(b8!=null&&b8.$==1)b9!=null&&b9.$==1?b8.$0[1]&&b9.$0[1]?Y.MarkForever(b5,null):Y.MarkReady(b5,null):void 0;}}b3=b1.s;b4=b2.s;return b3!=null&&b3.$==0?b4!=null&&b4.$==0?Y.New({$:0,$0:null}):b2:b4!=null&&b4.$==0?b1:(b5=Y.New({$:3,$0:[],$1:[]}),(Y.When(b1,b6,b5),Y.When(b2,b6,b5),b5));};Y.MarkForever=function(b1,b2){var b3,b4,b5,b6;b3=b1.s;if(b3!=null&&b3.$==3){b1.s={$:0,$0:b2};b4=b3.$0;for(b5=0,b6=f.length(b4)-1;b5<=b6;b5++)(f.get(b4,b5))(b2);}else void 0;};Y.MarkReady=function(b1,b2){var b3,b4,b5,b6;b3=b1.s;if(b3!=null&&b3.$==3){b1.s={$:2,$0:b2,$1:b3.$1};b4=b3.$0;for(b5=0,b6=f.length(b4)-1;b5<=b6;b5++)(f.get(b4,b5))(b2);}else void 0;};Y.WhenRun=function(b1,b2,b3){var b4;b4=b1.s;if(b4==null)b3();else b4!=null&&b4.$==2?(b4.$1.push(b3),b2(b4.$0)):b4!=null&&b4.$==3?(b4.$0.push(b2),b4.$1.push(b3)):b2(b4.$0);};Y.ValueAndForever=function(b1){var b2;b2=b1.s;return b2!=null&&b2.$==0?{$:1,$0:[b2.$0,true]}:b2!=null&&b2.$==2?{$:1,$0:[b2.$0,false]}:null;};Y.Map3=function(b1,b2,b3,b4){var b5,b6,b7,b8;function b9(b_){var b$,ca,cb,cc;if(!(b$=b8.s,b$!=null&&b$.$==0||b$!=null&&b$.$==2)){ca=Y.ValueAndForever(b2);cb=Y.ValueAndForever(b3);cc=Y.ValueAndForever(b4);if(ca!=null&&ca.$==1)cb!=null&&cb.$==1?cc!=null&&cc.$==1?ca.$0[1]&&cb.$0[1]&&cc.$0[1]?Y.MarkForever(b8,b1(ca.$0[0],cb.$0[0],cc.$0[0])):Y.MarkReady(b8,b1(ca.$0[0],cb.$0[0],cc.$0[0])):void 0:void 0;}}b5=b2.s;b6=b3.s;b7=b4.s;return b5!=null&&b5.$==0?b6!=null&&b6.$==0?b7!=null&&b7.$==0?Y.New({$:0,$0:b1(b5.$0,b6.$0,b7.$0)}):Y.Map3Opt1(b1,b5.$0,b6.$0,b4):b7!=null&&b7.$==0?Y.Map3Opt2(b1,b5.$0,b7.$0,b3):Y.Map3Opt3(b1,b5.$0,b3,b4):b6!=null&&b6.$==0?b7!=null&&b7.$==0?Y.Map3Opt4(b1,b6.$0,b7.$0,b2):Y.Map3Opt5(b1,b6.$0,b2,b4):b7!=null&&b7.$==0?Y.Map3Opt6(b1,b7.$0,b2,b3):(b8=Y.New({$:3,$0:[],$1:[]}),(Y.When(b2,b9,b8),Y.When(b3,b9,b8),Y.When(b4,b9,b8),b8));};Y.Sequence=function(b1){var b2,b3,b4;function b5(b6){var b7;if(b4[0]===0){b7=f.map(function(b8){var b9;b9=b8.s;return b9!=null&&b9.$==0?b9.$0:b9!=null&&b9.$==2?b9.$0:e.FailWith("value not found by View.Sequence");},b2);if(f.forall(function(b8){var b9;b9=b8.s;return b9!=null&&b9.$==0;},b2))Y.MarkForever(b3,b7);else Y.MarkReady(b3,b7);}else b4[0]--;}b2=f.ofSeq(b1);return b2.length==0?Y.New({$:0,$0:[]}):(b3=Y.New({$:3,$0:[],$1:[]}),(b4=[f.length(b2)-1],(f.iter(function(b6){Y.When(b6,b5,b3);},b2),b3)));};Y.Map2=function(b1,b2,b3){var b4,b5,b6;function b7(b8){var b9,b_,b$;if(!(b9=b6.s,b9!=null&&b9.$==0||b9!=null&&b9.$==2)){b_=Y.ValueAndForever(b2);b$=Y.ValueAndForever(b3);if(b_!=null&&b_.$==1)b$!=null&&b$.$==1?b_.$0[1]&&b$.$0[1]?Y.MarkForever(b6,b1(b_.$0[0],b$.$0[0])):Y.MarkReady(b6,b1(b_.$0[0],b$.$0[0])):void 0;}}b4=b2.s;b5=b3.s;return b4!=null&&b4.$==0?b5!=null&&b5.$==0?Y.New({$:0,$0:b1(b4.$0,b5.$0)}):Y.Map2Opt1(b1,b4.$0,b3):b5!=null&&b5.$==0?Y.Map2Opt2(b1,b5.$0,b2):(b6=Y.New({$:3,$0:[],$1:[]}),(Y.When(b2,b7,b6),Y.When(b3,b7,b6),b6));};Y.Copy=function(b1){var b2,b3,b4;b2=b1.s;return b2==null?b1:b2!=null&&b2.$==2?(b3=Y.New({$:2,$0:b2.$0,$1:[]}),(Y.WhenObsolete(b1,b3),b3)):b2!=null&&b2.$==3?(b4=Y.New({$:3,$0:[],$1:[]}),(Y.When(b1,function(b5){Y.MarkDone(b4,b1,b5);},b4),b4)):b1;};Y.Join=function(b1){var b2;b2=Y.New({$:3,$0:[],$1:[]});Y.When(b1,function(b3){var b4;b4=b3();Y.When(b4,function(b5){var b6,b7;if((b6=b4.s,b6!=null&&b6.$==0)&&(b7=b1.s,b7!=null&&b7.$==0))Y.MarkForever(b2,b5);else Y.MarkReady(b2,b5);},b2);},b2);return b2;};Y.Map3Opt1=function(b1,b2,b3,b4){return Y.Map(function(b5){return b1(b2,b3,b5);},b4);};Y.Map3Opt2=function(b1,b2,b3,b4){return Y.Map(function(b5){return b1(b2,b5,b3);},b4);};Y.Map3Opt3=function(b1,b2,b3,b4){return Y.Map2(function(b5,b6){return b1(b2,b5,b6);},b3,b4);};Y.Map3Opt4=function(b1,b2,b3,b4){return Y.Map(function(b5){return b1(b5,b2,b3);},b4);};Y.Map3Opt5=function(b1,b2,b3,b4){return Y.Map2(function(b5,b6){return b1(b5,b2,b6);},b3,b4);};Y.Map3Opt6=function(b1,b2,b3,b4){return Y.Map2(function(b5,b6){return b1(b5,b6,b2);},b3,b4);};Y.Map2Opt1=function(b1,b2,b3){return Y.Map(function(b4){return b1(b2,b4);},b3);};Y.Map2Opt2=function(b1,b2,b3){return Y.Map(function(b4){return b1(b4,b2);},b3);};Z.InMemory=function(b1){return new _.New(b1);};_0.ofSeqNonCopying=function(b1){var b2,b3;if(b1 instanceof a.Array)return b1;else if(b1 instanceof A)return f.ofList(b1);else if(b1===null)return[];else{b2=[];b3=_4.Get(b1);try{while(b3.MoveNext())b2.push(b3.Current());return b2;}finally{if(typeof b3=="object"&&"Dispose"in b3)b3.Dispose();}}};_0.TreeReduce=function(b1,b2,b3){var b4;function b5(b6){return function(b7){var b8,b9;return b7<=0?b1:b7===1&&(b6>=0&&b6<b4)?f.get(b3,b6):(b9=b7/2>>0,b2((b5(b6))(b9),(b5(b6+b9))(b7-b9)));};}b4=f.length(b3);return(b5(0))(b4);};_0.MapTreeReduce=function(b1,b2,b3,b4){var b5;function b6(b7){return function(b8){var b9,b_;return b8<=0?b2:b8===1&&(b7>=0&&b7<b5)?b1(f.get(b4,b7)):(b_=b8/2>>0,b3((b6(b7))(b_),(b6(b7+b_))(b8-b_)));};}b5=f.length(b4);return(b6(0))(b5);};_0.mapInPlace=function(b1,b2){var b3,b4;for(b3=0,b4=b2.length-1;b3<=b4;b3++)b2[b3]=b1(b2[b3]);return b2;};_1.Activate=function(b1){var b2,b4,b5,b6,b7,b8,b9;function b3(b_){var b$,ca,cb,cc,cd;if(w.Equals(b_,null))return b_;else if(typeof b_=="object"){if(b_ instanceof a.Array)return _1.shallowMap(b3,b_);else{b$=_1.shallowMap(b3,b_.$V);ca=b_.$T;if(ca===void 0)return b$;else{cb=f.get(b4,ca);if(cb===1)return z.ofArray(b$);else if(cb===2)return self.WebSharper.Decimal.CreateDecimalBits(b$);else{cc=new(f.get(b4,ca))();for(var ce in b$)if(function(cf){cc[cf]=b$[cf];return false;}(ce))break;return cc;}}}}else return b_;}b4=b1?b1.$TYPES:void 0;if(b4===void 0)b2=b1;else{for(b5=0,b6=f.length(b4)-1;b5<=b6;b5++){b9=f.get(b4,b5);switch(!w.Equals(b9,null)&&b9.length===3?f.get(b9,0)==="WebSharper"?f.get(b9,1)==="List"?f.get(b9,2)==="T"?0:(b8=b9,2):(b8=b9,2):(b8=b9,2):!w.Equals(b9,null)&&b9.length===2?f.get(b9,0)==="WebSharper"?f.get(b9,1)==="Decimal"?1:(b8=b9,2):(b8=b9,2):(b8=b9,2)){case 0:b7=1;break;case 1:b7=2;break;case 2:b7=_1.lookup(b8);break;}f.set(b4,b5,b7);}b2=b1.$DATA;}return b3(b2);};_1.shallowMap=function(b1,b2){var b3,b4;if(b2 instanceof a.Array)return f.map(b1,b2);else if(typeof b2=="object"){b3={};for(var b5 in b2)if(function(b6){b3[b6]=b1(b2[b6]);return false;}(b5))break;return b3;}else return b2;};_1.lookup=function(b1){var b2,b3,b4,b5,b6;b4=f.length(b1);b2=self;b3=0;while(b3<b4){b5=f.get(b1,b3);b6=b2[b5];if(!w.Equals(typeof b6,void 0)){b2=b6;b3=b3+1;}else e.FailWith("Invalid server reply. Failed to find type: "+b5);}return b2;};m.AjaxProvider=function(){bf.$cctor();return bf.AjaxProvider;};m.makePayload=function(b1){return bZ.stringify(b1);};m.makeHeaders=function(b1){return{"content-type":"application/json","x-websharper-rpc":b1};};m.EndPoint=function(){bf.$cctor();return bf.EndPoint;};m.ajax=function(b1,b2,b3,b4,b5,b6,b7){var b8,b9,b_;b8=new a.XMLHttpRequest();b9=a.document.cookie.replace(new a.RegExp("(?:(?:^|.*;)\\s*csrftoken\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");b8.open("POST",b2,b1);if(b1==true)b8.withCredentials=true;for(var ca in b3)b8.setRequestHeader(ca,b3[ca]);if(b9)b8.setRequestHeader("x-csrftoken",b9);function b$(){var cb;if(b8.status==200)b5(b8.responseText);else if(b7&&b8.status==403&&b8.responseText=="CSRF")b7();else{cb="Response status is not 200: ";b6(new bd(cb+b8.status));}}if("onload"in b8)b8.onload=b8.onerror=b8.onabort=b$;else b8.onreadystatechange=function(){if(b8.readyState==4)b$();};b8.send(b4);};_2=d.CancellationTokenSource=bY.Class({},g,_2);_2.New=bY.Ctor(function(){g.New.call(this);this.c=false;this.pending=null;this.r=[];this.init=1;},_2);_3.notPresent=function(){return e.FailWith("The given key was not present in the dictionary.");};_3.alreadyAdded=function(){return e.FailWith("An item with the same key has already been added.");};_4.Get=function(b1){return b1 instanceof a.Array?_4.ArrayEnumerator(b1):w.Equals(typeof b1,"string")?_4.StringEnumerator(b1):b1.GetEnumerator();};_4.ArrayEnumerator=function(b1){return new _5.New(0,null,function(b2){var b3;b3=b2.s;return b3<f.length(b1)&&(b2.c=f.get(b1,b3),b2.s=b3+1,true);},void 0);};_4.StringEnumerator=function(b1){return new _5.New(0,null,function(b2){var b3;b3=b2.s;return b3<b1.length&&(b2.c=b1[b3],b2.s=b3+1,true);},void 0);};_4.Get0=function(b1){return b1 instanceof a.Array?_4.ArrayEnumerator(b1):w.Equals(typeof b1,"string")?_4.StringEnumerator(b1):"GetEnumerator0"in b1?b1.GetEnumerator0():b1.GetEnumerator();};_5=_4.T=bY.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},g,_5);_5.New=bY.Ctor(function(b1,b2,b3,b4){g.New.call(this);this.s=b1;this.c=b2;this.n=b3;this.d=b4;},_5);_9.Int=function(){_9.set_counter(_9.counter()+1);return _9.counter();};_9.set_counter=function(b1){bC.$cctor();bC.counter=b1;};_9.counter=function(){bC.$cctor();return bC.counter;};_9.Id=function(){_9.set_counter(_9.counter()+1);return"uid"+a.String(_9.counter());};_=Z.ArrayStorage=bY.Class({SSet:function(b1){return f.ofSeq(b1);},SRemoveIf:function(b1,b2){return f.filter(function(b3){return!b1(b3);},b2);},SInit:function(){return this.init;},SSetAt:function(b1,b2,b3){f.set(b3,b1,b2);return b3;},SAppend:function(b1,b2){b2.push(b1);return b2;}},g,_);_.New=bY.Ctor(function(b1){g.New.call(this);this.init=b1;},_);Y.Obsolete=function(b1){var b2,b3,b4,b5,b6;b3=b1.s;if(b3==null||(b3!=null&&b3.$==2?(b2=b3.$1,false):b3!=null&&b3.$==3?(b2=b3.$1,false):true))void 0;else{b1.s=null;for(b4=0,b5=f.length(b2)-1;b4<=b5;b4++){b6=f.get(b2,b4);if(typeof b6=="object")(function(b7){Y.Obsolete(b7);}(b6));else b6();}}};Y.New=function(b1){return{s:b1};};$=h.ReactiveExtensions=bY.Class({},g,$);ba.ParseHTMLIntoFakeRoot=function(b1){var b2,b3,b4,b5,b6;function b7(b8,b9){var b_;while(true)if(b9===0)return b8;else{b_=b9;b8=b8.lastChild;b9=b_-1;}}b2=self.document.createElement("div");return!ba.rhtml().test(b1)?(b2.appendChild(self.document.createTextNode(b1)),b2):(b3=(b4=ba.rtagName().exec(b1),w.Equals(b4,null)?"":f.get(b4,1).toLowerCase()),(b5=(b6=(ba.wrapMap())[b3],b6?b6:ba.defaultWrap()),(b2.innerHTML=b5[1]+b1.replace(ba.rxhtmlTag(),"<$1></$2>")+b5[2],b7(b2,b5[0]))));};ba.rhtml=function(){bF.$cctor();return bF.rhtml;};ba.wrapMap=function(){bF.$cctor();return bF.wrapMap;};ba.defaultWrap=function(){bF.$cctor();return bF.defaultWrap;};ba.rxhtmlTag=function(){bF.$cctor();return bF.rxhtmlTag;};ba.rtagName=function(){bF.$cctor();return bF.rtagName;};ba.IterSelector=function(b1,b2,b3){var b4,b5,b6;b4=b1.querySelectorAll(b2);for(b5=0,b6=b4.length-1;b5<=b6;b5++)b3(b4[b5]);};ba.ChildrenArray=function(b1){var b2,b3,b4;b2=[];for(b3=0,b4=b1.childNodes.length-1;b3<=b4;b3++)b2.push(b1.childNodes[b3]);return b2;};ba.InsertAt=function(b1,b2,b3){var b4;if(!(b3.parentNode===b1&&b2===(b4=b3.nextSibling,w.Equals(b4,null)?null:b4)))b1.insertBefore(b3,b2);};ba.RemoveNode=function(b1,b2){if(b2.parentNode===b1)b1.removeChild(b2);};bb=h.DocElemNode=bY.Class({Equals:function(b1){return this.ElKey===b1.ElKey;},GetHashCode:function(){return this.ElKey;}},null,bb);bb.New=function(b1,b2,b3,b4,b5,b6){var b7;return new bb((b7={Attr:b1,Children:b2,El:b4,ElKey:b5},(bY.SetOptional(b7,"Delimiters",b3),bY.SetOptional(b7,"Render",b6),b7)));};be=d.OperationCanceledException=bY.Class({},bd,be);be.New=bY.Ctor(function(b1){be.New$1.call(this,"The operation was canceled.",null,b1);},be);be.New$1=bY.Ctor(function(b1,b2,b3){this.message=b1;this.inner=b2;M.setPrototypeOf(this,be.prototype);this.ct=b3;},be);bf.$cctor=function(){bf.$cctor=a.ignore;bf.EndPoint="?";bf.AjaxProvider=new br.New();};bg.$cctor=function(){bg.$cctor=a.ignore;bg.LoadedTemplates=new S.New$5();bg.LocalTemplatesLoaded=false;bg.GlobalHoles=new S.New$5();bg.TextHoleRE="\\${([^}]+)}";bg.RenderedFullDocTemplate=null;};bh.convertTextNode=function(b1){var b2,b3,b4,b5,b6,b7;b2=null;b3=0;b5=b1.textContent;b6=new a.RegExp(W.TextHoleRE(),"g");while(b2=b6.exec(b5),b2!==null){b1.parentNode.insertBefore(self.document.createTextNode(bi.string(b5,{$:1,$0:b3},{$:1,$0:b6.lastIndex-f.get(b2,0).length-1})),b1);b3=b6.lastIndex;b7=self.document.createElement("span");b7.setAttribute("ws-replace",f.get(b2,1).toLowerCase());b1.parentNode.insertBefore(b7,b1);}b6.lastIndex=0;b1.textContent=bi.string(b5,{$:1,$0:b3},null);};bh.failNotLoaded=function(b1){bV.warn("Instantiating non-loaded template",b1);};bh.fillTextHole=function(b1,b2,b3){var b4;b4=b1.querySelector("[ws-replace]");return w.Equals(b4,null)?(bV.warn("Filling non-existent text hole",b3),null):(b4.parentNode.replaceChild(self.document.createTextNode(b2),b4),{$:1,$0:b4.getAttribute("ws-replace")});};bh.removeHolesExcept=function(b1,b2){function b3(b4){W.foreachNotPreserved(b1,"["+b4+"]",function(b5){if(!b2.Contains(b5.getAttribute(b4)))b5.removeAttribute(b4);});}b3("ws-attr");b3("ws-onafterrender");b3("ws-var");W.foreachNotPreserved(b1,"[ws-hole]",function(b4){if(!b2.Contains(b4.getAttribute("ws-hole"))){b4.removeAttribute("ws-hole");while(b4.hasChildNodes())b4.removeChild(b4.lastChild);}});W.foreachNotPreserved(b1,"[ws-replace]",function(b4){if(!b2.Contains(b4.getAttribute("ws-replace")))b4.parentNode.removeChild(b4);});W.foreachNotPreserved(b1,"[ws-on]",function(b4){b4.setAttribute("ws-on",bs.concat(" ",f.filter(function(b5){return b2.Contains(f.get(bs.SplitChars(b5,[":"],1),1));},bs.SplitChars(b4.getAttribute("ws-on"),[" "],1))));});W.foreachNotPreserved(b1,"[ws-attr-holes]",function(b4){var b5,b6,b7,b8,b9;b5=bs.SplitChars(b4.getAttribute("ws-attr-holes"),[" "],1);for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=f.get(b5,b6);b4.setAttribute(b8,(b9=new a.RegExp(W.TextHoleRE(),"g"),b4.getAttribute(b8).replace(b9,function(b_,b$){return b2.Contains(b$)?b_:"";})));}});};bh.fillInstanceAttrs=function(b1,b2){var b3,b4,b5,b6,b7;bh.convertAttrs(b2);b3=b2.nodeName.toLowerCase();b4=b1.querySelector("[ws-attr="+b3+"]");if(w.Equals(b4,null))bV.warn("Filling non-existent attr hole",b3);else{b4.removeAttribute("ws-attr");for(b5=0,b6=b2.attributes.length-1;b5<=b6;b5++){b7=b2.attributes.item(b5);if(b7.name==="class"&&b4.hasAttribute("class"))b4.setAttribute("class",b4.getAttribute("class")+" "+b7.nodeValue);else b4.setAttribute(b7.name,b7.nodeValue);}}};bh.mapHoles=function(b1,b2){function b3(b4){W.foreachNotPreserved(b1,"["+b4+"]",function(b5){var b6,b7;b6=(b7=null,[b2.TryGetValue(b5.getAttribute(b4).toLowerCase(),{get:function(){return b7;},set:function(b8){b7=b8;}}),b7]);if(b6[0])b5.setAttribute(b4,b6[1]);});}b3("ws-hole");b3("ws-replace");b3("ws-attr");b3("ws-onafterrender");b3("ws-var");W.foreachNotPreserved(b1,"[ws-on]",function(b4){b4.setAttribute("ws-on",bs.concat(" ",f.map(function(b5){var b6,b7,b8;b6=bs.SplitChars(b5,[":"],1);b7=(b8=null,[b2.TryGetValue(f.get(b6,1),{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?f.get(b6,0)+":"+b7[1]:b5;},bs.SplitChars(b4.getAttribute("ws-on"),[" "],1))));});W.foreachNotPreserved(b1,"[ws-attr-holes]",function(b4){var b5,b6,b7;b5=bs.SplitChars(b4.getAttribute("ws-attr-holes"),[" "],1);for(b6=0,b7=b5.length-1;b6<=b7;b6++)(function(){var b8;function b9(b_,b$){var ca;ca=e.KeyValue(b$);return b_.replace(new a.RegExp("\\${"+ca[0]+"}","ig"),"${"+ca[1]+"}");}b8=f.get(b5,b6);return b4.setAttribute(b8,(((bY.Curried3(K.fold))(b9))(b4.getAttribute(b8)))(b2));}());});};bh.fill=function(b1,b2,b3){while(true)if(b1.hasChildNodes())b3=b2.insertBefore(b1.lastChild,b3);else return null;};bh.convertAttrs=function(b1){var b3,b4,b5,b6,b7,b8,b9,b_;function b2(b$){var ca;ca=b1.getAttribute(b$);if(ca===null);else b1.setAttribute(b$,ca.toLowerCase());}b3=b1.attributes;b4=[];b5=[];b6=[];for(b7=0,b8=b3.length-1;b7<=b8;b7++){b9=b3.item(b7);if(bs.StartsWith(b9.nodeName,"ws-on")&&b9.nodeName!=="ws-onafterrender"&&b9.nodeName!=="ws-on"){b4.push(b9.nodeName);b5.push(bi.string(b9.nodeName,{$:1,$0:"ws-on".length},null)+":"+b9.nodeValue.toLowerCase());}else!bs.StartsWith(b9.nodeName,"ws-")&&(new a.RegExp(W.TextHoleRE())).test(b9.nodeValue)?(b9.nodeValue=(b_=new a.RegExp(W.TextHoleRE(),"g"),b9.nodeValue.replace(b_,function(b$,ca){return"${"+ca.toLowerCase()+"}";})),b6.push(b9.nodeName)):void 0;}if(!(b5.length==0))b1.setAttribute("ws-on",bs.concat(" ",b5));if(!(b6.length==0))b1.setAttribute("ws-attr-holes",bs.concat(" ",b6));b2("ws-hole");b2("ws-replace");b2("ws-attr");b2("ws-onafterrender");b2("ws-var");f.iter(function(b$){b1.removeAttribute(b$);},b4);};bi.string=function(b1,b2,b3){return b2==null?b3!=null&&b3.$==1?b1.slice(0,b3.$0+1):"":b3==null?b1.slice(b2.$0):b1.slice(b2.$0,b3.$0+1);};bk=h.Elt=bY.Class({},I,bk);bk.TreeNode=function(b1,b2){var b3,b4;function b5(b6){return b6[1];}b3=bv.Create(b2);return new bk.New$1({$:6,$0:b1},H.Map2Unit((b4=f.map(function(b6){return bt.Updates(b5(b6));},b1.Attrs),_0.TreeReduce(H.Const(),H.Map2Unit,b4)),b3.v),f.get(b1.Els,0),b3);};bk.New=function(b1,b2,b3){var b4,b5;b4=bl.CreateElemNode(b1,b2,b3.docNode);b5=bv.Create(b3.updates);return new bk.New$1({$:1,$0:b4},H.Map2Unit(bt.Updates(b4.Attr),b5.v),b1,b5);};bk.New$1=bY.Ctor(function(b1,b2,b3,b4){I.New.call(this,b1,b2);this.docNode$1=b1;this.updates$1=b2;this.elt=b3;this.rvUpdates=b4;},bk);bl.CreateRunState=function(b1,b2){return by.New(bz.get_Empty(),bl.CreateElemNode(b1,bt.EmptyAttr(),b2));};bl.PerformAnimatedUpdate=function(b1,b2,b3){var b4;return bm.get_UseAnimations()?(b4=null,p.Delay(function(){var b5,b6,b7;b5=bz.FindAll(b3);b6=bl.ComputeChangeAnim(b2,b5);b7=bl.ComputeEnterAnim(b2,b5);return p.Bind(bm.Play(bm.Append(b6,bl.ComputeExitAnim(b2,b5))),function(){return p.Bind(bl.SyncElemNodesNextFrame(b1,b2),function(){return p.Bind(bm.Play(b7),function(){b2.PreviousNodes=b5;return p.Return(null);});});});})):bl.SyncElemNodesNextFrame(b1,b2);};bl.PerformSyncUpdate=function(b1,b2,b3){var b4;b4=bz.FindAll(b3);bl.SyncElemNode(b1,b2.Top);b2.PreviousNodes=b4;};bl.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bl.UpdateEmbedNode=function(b1,b2){b1.Current=b2;b1.Dirty=true;};bl.LinkElement=function(b1,b2){bl.InsertDoc(b1,b2,null);};bl.InsertBeforeDelim=function(b1,b2){var b3,b4;b3=b1.parentNode;b4=self.document.createTextNode("");b3.insertBefore(b4,b1);bl.LinkPrevElement(b1,b2);return b4;};bl.CreateElemNode=function(b1,b2,b3){var b4;bl.LinkElement(b1,b3);b4=bt.Insert(b1,b2);return bb.New(b4,b3,null,b1,_9.Int(),bY.GetOptional(b4.OnAfterRender));};bl.SyncElemNodesNextFrame=function(b1,b2){function b3(b4){a.requestAnimationFrame(function(){bl.SyncElemNode(b1,b2.Top);b4();});}return bn.BatchUpdatesEnabled()?p.FromContinuations(function(b4,b5,b6){return b3.apply(null,[b4,b5,b6]);}):(bl.SyncElemNode(b1,b2.Top),p.Return(null));};bl.ComputeExitAnim=function(b1,b2){return bm.Concat(f.map(function(b3){return bt.GetExitAnim(b3.Attr);},bz.ToArray(bz.Except(b2,bz.Filter(function(b3){return bt.HasExitAnim(b3.Attr);},b1.PreviousNodes)))));};bl.ComputeEnterAnim=function(b1,b2){return bm.Concat(f.map(function(b3){return bt.GetEnterAnim(b3.Attr);},bz.ToArray(bz.Except(b1.PreviousNodes,bz.Filter(function(b3){return bt.HasEnterAnim(b3.Attr);},b2)))));};bl.ComputeChangeAnim=function(b1,b2){var b3;function b4(b5){return bt.HasChangeAnim(b5.Attr);}b3=function(b5){return bz.Filter(b4,b5);};return bm.Concat(f.map(function(b5){return bt.GetChangeAnim(b5.Attr);},bz.ToArray(bz.Intersect(b3(b1.PreviousNodes),b3(b2)))));};bl.SyncElemNode=function(b1,b2){!b1?bl.SyncElement(b2):void 0;bl.Sync(b2.Children);bl.AfterRender(b2);};bl.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bl.UpdateTextNode=function(b1,b2){b1.Value=b2;b1.Dirty=true;};bl.InsertDoc=function(b1,b2,b3){var b4,b5,b6;while(true)if(b2!=null&&b2.$==1)return bl.InsertNode(b1,b2.$0.El,b3);else if(b2!=null&&b2.$==2){b4=b2.$0;b4.Dirty=false;b2=b4.Current;}else if(b2==null)return b3;else if(b2!=null&&b2.$==4)return bl.InsertNode(b1,b2.$0.Text,b3);else if(b2!=null&&b2.$==5)return bl.InsertNode(b1,b2.$0,b3);else if(b2!=null&&b2.$==6)return f.foldBack(function(b7,b8){return(((bY.Curried3(function(b9,b_,b$){return b_==null||b_.constructor===M?bl.InsertDoc(b9,b_,b$):bl.InsertNode(b9,b_,b$);}))(b1))(b7))(b8);},b2.$0.Els,b3);else{b5=b2.$1;b6=b2.$0;b2=b6;b3=bl.InsertDoc(b1,b5,b3);}};bl.LinkPrevElement=function(b1,b2){bl.InsertDoc(b1.parentNode,b2,b1);};bl.SyncElement=function(b1){function b2(b3){function b4(b5){var b6,b7,b8,b9;while(true){if(b5!=null&&b5.$==0){b7=b5.$1;b8=b5.$0;if(b4(b8))return true;else b5=b7;}else if(b5!=null&&b5.$==2){b9=b5.$0;if(b9.Dirty)return true;else b5=b9.Current;}else return b5!=null&&b5.$==6&&(b6=b5.$0,b6.Dirty||f.exists(b2,b6.Holes));}}return b4(b3.Children);}bt.Sync(b1.El,b1.Attr);if(b2(b1))bl.DoSyncElement(b1);};bl.Sync=function(b1){var b2,b3,b4,b5,b6;while(true){if(b1!=null&&b1.$==1)return bl.SyncElemNode(false,b1.$0);else if(b1!=null&&b1.$==2){b4=b1.$0;b1=b4.Current;}else if(b1==null)return null;else if(b1!=null&&b1.$==5)return null;else if(b1!=null&&b1.$==4){b2=b1.$0;return b2.Dirty?(b2.Text.nodeValue=b2.Value,b2.Dirty=false):null;}else if(b1!=null&&b1.$==6){b3=b1.$0;f.iter(function(b7){return function(b8){bl.SyncElemNode(b7,b8);};}(false),b3.Holes);f.iter(function(b7){bt.Sync(b7[0],b7[1]);},b3.Attrs);return bl.AfterRender(b3);}else{b5=b1.$1;b6=b1.$0;bl.Sync(b6);b1=b5;}}};bl.AfterRender=function(b1){var b2;b2=bY.GetOptional(b1.Render);if(b2!=null&&b2.$==1){b2.$0(b1.El);bY.SetOptional(b1,"Render",null);}};bl.InsertNode=function(b1,b2,b3){ba.InsertAt(b1,b3,b2);return b2;};bl.DoSyncElement=function(b1){var b2,b3,b4;function b5(b6,b7){var b8,b9,b_,b$;while(true){if(b6!=null&&b6.$==1)return b6.$0.El;else if(b6!=null&&b6.$==2){b9=b6.$0;if(b9.Dirty){b9.Dirty=false;return bl.InsertDoc(b2,b9.Current,b7);}else b6=b9.Current;}else if(b6==null)return b7;else if(b6!=null&&b6.$==4)return b6.$0.Text;else if(b6!=null&&b6.$==5)return b6.$0;else if(b6!=null&&b6.$==6){b8=b6.$0;b8.Dirty?b8.Dirty=false:void 0;return f.foldBack(function(ca,cb){return ca==null||ca.constructor===M?b5(ca,cb):ca;},b8.Els,b7);}else{b_=b6.$1;b$=b6.$0;b6=b$;b7=b5(b_,b7);}}}b2=b1.El;bP.Iter((b3=b1.El,function(b6){ba.RemoveNode(b3,b6);}),bP.Except(bP.DocChildren(b1),bP.Children(b1.El,bY.GetOptional(b1.Delimiters))));b5(b1.Children,(b4=bY.GetOptional(b1.Delimiters),b4!=null&&b4.$==1?b4.$0[1]:null));};bm.get_UseAnimations=function(){return bA.UseAnimations();};bm.Play=function(b1){var b2;b2=null;return p.Delay(function(){return p.Bind(bm.Run(a.ignore,bA.Actions(b1)),function(){bA.Finalize(b1);return p.Return(null);});});};bm.Append=function(b1,b2){return{$:0,$0:bI.Append(b1.$0,b2.$0)};};bm.Run=function(b1,b2){var b3;function b4(b5){function b6(b7){return function(b8){var b9;b9=b8-b7;b2.Compute(b9);b1();return b9<=b3?void a.requestAnimationFrame(function(b_){(b6(b7))(b_);}):b5();};}a.requestAnimationFrame(function(b7){(b6(b7))(b7);});}b3=b2.Duration;return b3===0?p.Zero():p.FromContinuations(function(b5,b6,b7){return b4.apply(null,[b5,b6,b7]);});};bm.Concat=function(b1){return{$:0,$0:bI.Concat(K.map(bA.List,b1))};};bm.get_Empty=function(){return{$:0,$0:bI.Empty()};};bn.BatchUpdatesEnabled=function(){bB.$cctor();return bB.BatchUpdatesEnabled;};bo.StartProcessor=function(b1){var b2;function b3(){var b4;b4=null;return p.Delay(function(){return p.Bind(b1,function(){var b5;b5=b2[0];return b5===1?(b2[0]=0,p.Zero()):b5===2?(b2[0]=1,b3()):p.Zero();});});}b2=[0];return function(){var b4;b4=b2[0];if(b4===0){b2[0]=1;p.Start(b3(),null);}else b4===1?b2[0]=2:void 0;};};bq.New=function(b1,b2,b3,b4){var b5;b5={DynElem:b1,DynFlags:b2,DynNodes:b3};bY.SetOptional(b5,"OnAfterRender",b4);return b5;};br=m.XhrProvider=bY.Class({Sync:function(b1,b2,b3){var b4;b4=[null];m.ajax(false,b1,b2,b3,function(b5){b4[0]=b5;},function(b5){throw b5;},function(){m.ajax(false,b1,b2,b3,function(b5){b4[0]=b5;},function(b5){throw b5;},void 0);});return b4[0];},Async:function(b1,b2,b3,b4,b5){m.ajax(true,b1,b2,b3,b4,b5,function(){m.ajax(true,b1,b2,b3,b4,b5,void 0);});}},g,br);br.New=bY.Ctor(function(){g.New.call(this);},br);bs.concat=function(b1,b2){return f.ofSeq(b2).join(b1);};bs.SplitChars=function(b1,b2,b3){return bs.Split(b1,new a.RegExp("["+bs.RegexEscape(b2.join(""))+"]"),b3);};bs.StartsWith=function(b1,b2){return b1.substring(0,b2.length)==b2;};bs.Split=function(b1,b2,b3){return b3===1?f.filter(function(b4){return b4!=="";},bs.SplitWith(b1,b2)):bs.SplitWith(b1,b2);};bs.RegexEscape=function(b1){return b1.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};bs.SplitWith=function(b1,b2){return b1.split(b2);};bs.forall=function(b1,b2){return K.forall(b1,bs.protect(b2));};bs.protect=function(b1){return b1===null?"":b1;};bt.Insert=function(b1,b2){var b3,b4,b5;function b6(b7){var b8,b9;while(true)if(!(b7===null)){if(b7!=null&&b7.$==1)return b3.push(b7.$0);else if(b7!=null&&b7.$==2){b8=b7.$1;b9=b7.$0;b6(b9);b7=b8;}else return b7!=null&&b7.$==3?b7.$0(b1):b7!=null&&b7.$==4?b4.push(b7.$0):null;}else return null;}b3=[];b4=[];b6(b2);b5=b3.slice(0);return bq.New(b1,bt.Flags(b2),b5,b4.length===0?null:{$:1,$0:function(b7){K.iter(function(b8){b8(b7);},b4);}});};bt.Updates=function(b1){return _0.MapTreeReduce(function(b2){return b2.NChanged();},H.Const(),H.Map2Unit,b1.DynNodes);};bt.Empty=function(b1){return bq.New(b1,0,[],null);};bt.Flags=function(b1){return b1!==null&&b1.hasOwnProperty("flags")?b1.flags:0;};bt.Static=function(b1){return new N({$:3,$0:b1});};bt.Dynamic=function(b1,b2){return new N({$:1,$0:new bL.New(b1,b2)});};bt.EmptyAttr=function(){bK.$cctor();return bK.EmptyAttr;};bt.HasExitAnim=function(b1){var b2;b2=2;return(b1.DynFlags&b2)===b2;};bt.GetExitAnim=function(b1){return bt.GetAnim(b1,function(b2,b3){return b2.NGetExitAnim(b3);});};bt.HasEnterAnim=function(b1){var b2;b2=1;return(b1.DynFlags&b2)===b2;};bt.GetEnterAnim=function(b1){return bt.GetAnim(b1,function(b2,b3){return b2.NGetEnterAnim(b3);});};bt.HasChangeAnim=function(b1){var b2;b2=4;return(b1.DynFlags&b2)===b2;};bt.GetChangeAnim=function(b1){return bt.GetAnim(b1,function(b2,b3){return b2.NGetChangeAnim(b3);});};bt.AppendTree=function(b1,b2){var b3;return b1===null?b2:b2===null?b1:(b3=new N({$:2,$0:b1,$1:b2}),(bt.SetFlags(b3,bt.Flags(b1)|bt.Flags(b2)),b3));};bt.GetAnim=function(b1,b2){return bm.Concat(f.map(function(b3){return b2(b3,b1.DynElem);},b1.DynNodes));};bt.Sync=function(b1,b2){f.iter(function(b3){b3.NSync(b1);},b2.DynNodes);};bt.SetFlags=function(b1,b2){b1.flags=b2;};bu.Handler=function(b1,b2){return bt.Static(function(b3){b3.addEventListener(b1,function(b4){return(b2(b3))(b4);},false);});};bu.OnAfterRender=function(b1){return new N({$:4,$0:b1});};bu.Value=function(b1){var b2;b2=(((bG.StringApply())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.Checked=function(b1){var b2;b2=(((bG.BoolCheckedApply())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.IntValue=function(b1){var b2;b2=(((bG.IntApplyChecked())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.IntValueUnchecked=function(b1){var b2;b2=(((bG.IntApplyUnchecked())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.FloatValue=function(b1){var b2;b2=(((bG.FloatApplyChecked())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.FloatValueUnchecked=function(b1){var b2;b2=(((bG.FloatApplyUnchecked())(b1))(bt.Static))(function(b3){return bu.DynamicCustom(b3,b1.get_View());});return N.Append(b2[0],b2[1]);};bu.Dynamic=function(b1,b2){return bt.Dynamic(b2,function(b3){return function(b4){return b3.setAttribute(b1,b4);};});};bu.DynamicCustom=function(b1,b2){return bt.Dynamic(b2,b1);};bv=h.Updates=bY.Class({},null,bv);bv.Create=function(b1){var b2;b2=null;b2=bv.New(b1,null,function(){var b3;b3=b2.s;return b3===null?(b3=Y.Copy(b2.c()),b2.s=b3,Y.WhenObsoleteRun(b3,function(){b2.s=null;}),b3):b3;});return b2;};bv.New=function(b1,b2,b3){return new bv({c:b1,s:b2,v:b3});};bw=u.ValueCollection=bY.Class({GetEnumerator$1:function(){return _4.Get(K.map(function(b1){return b1.V;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},g,bw);bw.New=bY.Ctor(function(b1){g.New.call(this);this.d=b1;},bw);by.New=function(b1,b2){return{PreviousNodes:b1,Top:b2};};bz.get_Empty=function(){return{$:0,$0:new T.New$3()};};bz.FindAll=function(b1){var b2;function b3(b6,b7){var b8,b9,b_,b$,ca;while(true)switch(b6){case 0:if(b7!=null&&b7.$==0){b9=b7.$1;b_=b7.$0;b3(0,b_);b7=b9;}else if(b7!=null&&b7.$==1){b$=b7.$0;b7=b$;b6=1;}else if(b7!=null&&b7.$==2){ca=b7.$0;b7=ca.Current;}else return b7!=null&&b7.$==6?(b8=b7.$0.Holes,(function(cb){return function(cc){f.iter(cb,cc);};}(b5))(b8)):null;break;case 1:b2.push(b7);b7=b7.Children;b6=0;break;}}function b4(b6){return b3(0,b6);}function b5(b6){return b3(1,b6);}b2=[];b4(b1);return{$:0,$0:new T.New$2(b2)};};bz.Filter=function(b1,b2){return{$:0,$0:bN.Filter(b1,b2.$0)};};bz.Except=function(b1,b2){return{$:0,$0:bN.Except(b1.$0,b2.$0)};};bz.ToArray=function(b1){return bN.ToArray(b1.$0);};bz.Intersect=function(b1,b2){return{$:0,$0:bN.Intersect(b1.$0,b2.$0)};};bA.UseAnimations=function(){bH.$cctor();return bH.UseAnimations;};bA.Actions=function(b1){return bA.ConcatActions(f.choose(function(b2){return b2.$==1?{$:1,$0:b2.$0}:null;},bI.ToArray(b1.$0)));};bA.Finalize=function(b1){f.iter(function(b2){if(b2.$==0)b2.$0();},bI.ToArray(b1.$0));};bA.ConcatActions=function(b1){var b2,b3,b4,b5;b2=_0.ofSeqNonCopying(b1);b3=f.length(b2);return b3===0?bA.Const():b3===1?f.get(b2,0):(b4=K.max(K.map(function(b6){return b6.Duration;},b2)),(b5=f.map(function(b6){return bA.Prolong(b4,b6);},b2),bA.Def(b4,function(b6){f.iter(function(b7){b7.Compute(b6);},b5);})));};bA.List=function(b1){return b1.$0;};bA.Const=function(b1){return bA.Def(0,function(){return b1;});};bA.Def=function(b1,b2){return{Compute:b2,Duration:b1};};bA.Prolong=function(b1,b2){var b3,b4,b5;b3=b2.Compute;b4=b2.Duration;b5=bR.Create(function(){return b2.Compute(b2.Duration);});return{Compute:function(b6){return b6>=b4?b5.f():b3(b6);},Duration:b1};};bB.$cctor=function(){bB.$cctor=a.ignore;bB.BatchUpdatesEnabled=true;};bC.$cctor=function(){bC.$cctor=a.ignore;bC.counter=0;};bD.concat=function(b1){var b2,b3;b2=[];for(var b4 in b1)b2.push.apply(b2,b1[b4]);return b2;};K.insufficient=function(){return e.FailWith("The input sequence has an insufficient number of elements.");};bE=u.KeyCollection=bY.Class({GetEnumerator$1:function(){return _4.Get(K.map(function(b1){return b1.K;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},g,bE);bE.New=bY.Ctor(function(b1){g.New.call(this);this.d=b1;},bE);bF.$cctor=function(){var b1;bF.$cctor=a.ignore;bF.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");bF.rtagName=new a.RegExp("<([\\w:]+)");bF.rhtml=new a.RegExp("<|&#?\\w+;");bF.wrapMap=(b1=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:b1,tbody:b1,tfoot:b1,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});bF.defaultWrap=[0,"",""];};bG.StringApply=function(){bK.$cctor();return bK.StringApply;};bG.BoolCheckedApply=function(){bK.$cctor();return bK.BoolCheckedApply;};bG.IntApplyChecked=function(){bK.$cctor();return bK.IntApplyChecked;};bG.IntApplyUnchecked=function(){bK.$cctor();return bK.IntApplyUnchecked;};bG.FloatApplyChecked=function(){bK.$cctor();return bK.FloatApplyChecked;};bG.FloatApplyUnchecked=function(){bK.$cctor();return bK.FloatApplyUnchecked;};bG.ApplyValue=function(b1,b2,b3,b4,b5){return[b4(function(b6){function b7(){b3.UpdateMaybe(function(b8){var b9,b_;b9=b1(b6);return b9!=null&&b9.$==1&&(!w.Equals(b9.$0,b8)&&(b_=[b9,b9.$0],true))?b_[0]:null;});}b6.addEventListener("change",b7);b6.addEventListener("input",b7);b6.addEventListener("keypress",b7);}),b5(function(b6){return function(b7){var b8,b9;b8=b1(b6);return b8!=null&&b8.$==1&&(w.Equals(b8.$0,b7)&&(b9=b8.$0,true))?null:b2(b6,b7);};})];};bG.StringSet=function(){bK.$cctor();return bK.StringSet;};bG.StringGet=function(){bK.$cctor();return bK.StringGet;};bG.IntSetUnchecked=function(){bK.$cctor();return bK.IntSetUnchecked;};bG.IntGetUnchecked=function(){bK.$cctor();return bK.IntGetUnchecked;};bG.IntSetChecked=function(){bK.$cctor();return bK.IntSetChecked;};bG.IntGetChecked=function(){bK.$cctor();return bK.IntGetChecked;};bG.FloatSetUnchecked=function(){bK.$cctor();return bK.FloatSetUnchecked;};bG.FloatGetUnchecked=function(){bK.$cctor();return bK.FloatGetUnchecked;};bG.FloatSetChecked=function(){bK.$cctor();return bK.FloatSetChecked;};bG.FloatGetChecked=function(){bK.$cctor();return bK.FloatGetChecked;};bH.$cctor=function(){bH.$cctor=a.ignore;bH.CubicInOut=bM.Custom(function(b1){var b2;b2=b1*b1;return 3*b2-2*(b2*b1);});bH.UseAnimations=true;};bI.Append=function(b1,b2){return b1.$==0?b2:b2.$==0?b1:{$:2,$0:b1,$1:b2};};bI.ToArray=function(b1){var b2;function b3(b4){var b5,b6;while(true)if(b4.$==1)return b2.push(b4.$0);else if(b4.$==2){b5=b4.$1;b6=b4.$0;b3(b6);b4=b5;}else return b4.$==3?f.iter(function(b7){b2.push(b7);},b4.$0):null;}b2=[];b3(b1);return b2.slice(0);};bI.Concat=function(b1){var b2;b2=_0.ofSeqNonCopying(b1);return _0.TreeReduce(bI.Empty(),bI.Append,b2);};bI.Empty=function(){bS.$cctor();return bS.Empty;};bJ.Clear=function(b1){b1.splice(0,f.length(b1));};bK.$cctor=function(){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;bK.$cctor=a.ignore;bK.EmptyAttr=null;bK.BoolCheckedApply=bY.Curried3(function(b$,ca,cb){return[ca(function(cc){cc.addEventListener("change",function(){return!w.Equals(b$.Get(),cc.checked)?b$.Set(cc.checked):null;});}),cb(function(cc){return function(cd){cc.checked=cd;};})];});bK.StringSet=function(b$){return function(ca){b$.value=ca;};};bK.StringGet=function(b$){return{$:1,$0:b$.value};};bK.StringApply=(b1=bG.StringGet(),(b2=bG.StringSet(),bY.Curried(bG.ApplyValue,3,[b1,function(b$,ca){return(b2(b$))(ca);}])));bK.IntSetUnchecked=function(b$){return function(ca){b$.value=a.String(ca);};};bK.IntGetUnchecked=function(b$){var ca,cb;ca=b$.value;return bO.isBlank(ca)?{$:1,$0:0}:(cb=+ca,cb!==cb>>0?null:{$:1,$0:cb});};bK.IntApplyUnchecked=(b3=bG.IntGetUnchecked(),(b4=bG.IntSetUnchecked(),bY.Curried(bG.ApplyValue,3,[b3,function(b$,ca){return(b4(b$))(ca);}])));bK.IntSetChecked=function(b$){return function(ca){var cb;cb=ca.get_Input();return b$.value!==cb?void(b$.value=cb):null;};};bK.IntGetChecked=function(b$){var ca,cb,cc;ca=b$.value;return{$:1,$0:bO.isBlank(ca)?(b$.checkValidity?b$.checkValidity():true)?new O({$:2,$0:ca}):new O({$:1,$0:ca}):(cb=(cc=0,[P.TryParseInt32(ca,{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]),cb[0]?new O({$:0,$0:cb[1],$1:ca}):new O({$:1,$0:ca}))};};bK.IntApplyChecked=(b5=bG.IntGetChecked(),(b6=bG.IntSetChecked(),bY.Curried(bG.ApplyValue,3,[b5,function(b$,ca){return(b6(b$))(ca);}])));bK.FloatSetUnchecked=function(b$){return function(ca){b$.value=a.String(ca);};};bK.FloatGetUnchecked=function(b$){var ca,cb;ca=b$.value;return bO.isBlank(ca)?{$:1,$0:0}:(cb=+ca,a.isNaN(cb)?null:{$:1,$0:cb});};bK.FloatApplyUnchecked=(b7=bG.FloatGetUnchecked(),(b8=bG.FloatSetUnchecked(),bY.Curried(bG.ApplyValue,3,[b7,function(b$,ca){return(b8(b$))(ca);}])));bK.FloatSetChecked=function(b$){return function(ca){var cb;cb=ca.get_Input();return b$.value!==cb?void(b$.value=cb):null;};};bK.FloatGetChecked=function(b$){var ca,cb;ca=b$.value;return{$:1,$0:bO.isBlank(ca)?(b$.checkValidity?b$.checkValidity():true)?new O({$:2,$0:ca}):new O({$:1,$0:ca}):(cb=+ca,a.isNaN(cb)?new O({$:1,$0:ca}):new O({$:0,$0:cb,$1:ca}))};};bK.FloatApplyChecked=(b9=bG.FloatGetChecked(),(b_=bG.FloatSetChecked(),bY.Curried(bG.ApplyValue,3,[b9,function(b$,ca){return(b_(b$))(ca);}])));};bL=h.DynamicAttrNode=bY.Class({NChanged:function(){return this.updates;},NGetExitAnim:function(b1){return bm.get_Empty();},NGetEnterAnim:function(b1){return bm.get_Empty();},NGetChangeAnim:function(b1){return bm.get_Empty();},NSync:function(b1){if(this.dirty){(this.push(b1))(this.value);this.dirty=false;}}},g,bL);bL.New=bY.Ctor(function(b1,b2){var b3;b3=this;g.New.call(this);this.push=b2;this.value=void 0;this.dirty=false;this.updates=H.Map(function(b4){b3.value=b4;b3.dirty=true;},b1);},bL);bM=h.Easing=bY.Class({},g,bM);bM.Custom=function(b1){return new bM.New(b1);};bM.New=bY.Ctor(function(b1){g.New.call(this);this.transformTime=b1;},bM);bN.Filter=function(b1,b2){return new T.New$2(f.filter(b1,bN.ToArray(b2)));};bN.Except=function(b1,b2){var b3;b3=new T.New$2(bN.ToArray(b2));b3.ExceptWith(bN.ToArray(b1));return b3;};bN.ToArray=function(b1){var b2;b2=f.create(b1.get_Count(),void 0);b1.CopyTo(b2);return b2;};bN.Intersect=function(b1,b2){var b3;b3=new T.New$2(bN.ToArray(b1));b3.IntersectWith(bN.ToArray(b2));return b3;};bO.isBlank=function(b1){return bs.forall(bQ.IsWhiteSpace,b1);};bP.Children=function(b1,b2){var b3,b4,b5;if(b2!=null&&b2.$==1){b5=[];b3=b2.$0[0].nextSibling;while(b3!==b2.$0[1]){b5.push(b3);b3=b3.nextSibling;}return{$:0,$0:b5};}else return{$:0,$0:f.init(b1.childNodes.length,(b4=b1.childNodes,function(b6){return b4[b6];}))};};bP.Except=function(b1,b2){var b3;b3=b1.$0;return{$:0,$0:f.filter(function(b4){return f.forall(function(b5){return!(b4===b5);},b3);},b2.$0)};};bP.Iter=function(b1,b2){f.iter(b1,b2.$0);};bP.DocChildren=function(b1){var b2;function b3(b4){var b5,b6,b7,b8;while(true){if(b4!=null&&b4.$==2){b6=b4.$0;b4=b6.Current;}else if(b4!=null&&b4.$==1)return b2.push(b4.$0.El);else if(b4==null)return null;else if(b4!=null&&b4.$==5)return b2.push(b4.$0);else if(b4!=null&&b4.$==4)return b2.push(b4.$0.Text);else if(b4!=null&&b4.$==6){b5=b4.$0.Els;return(function(b9){return function(b_){f.iter(b9,b_);};}(function(b9){if(b9==null||b9.constructor===M)b3(b9);else b2.push(b9);}))(b5);}else{b7=b4.$1;b8=b4.$0;b3(b8);b4=b7;}}}b2=[];b3(b1.Children);return{$:0,$0:_0.ofSeqNonCopying(b2)};};bQ.IsWhiteSpace=function(b1){return b1.match(new a.RegExp("\\s"))!==null;};P.TryParse=function(b1,b2,b3,b4){var b5,b6;b5=+b1;b6=b5===b5-b5%1&&b5>=b2&&b5<=b3;if(b6)b4.set(b5);return b6;};bR.Create=function(b1){return bU.New(false,b1,bR.forceLazy);};bR.forceLazy=function(){var b1;b1=this.v();this.c=true;this.v=b1;this.f=bR.cachedLazy;return b1;};bR.cachedLazy=function(){return this.v;};bS.$cctor=function(){bS.$cctor=a.ignore;bS.Empty={$:0};};bU.New=function(b1,b2,b3){return{c:b1,v:b2,f:b3};};bY.OnLoad(function(){c.Main();});}(self));


if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '/Content/';
  IntelliFactory.Runtime.Start();
}
